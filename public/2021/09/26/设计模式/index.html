<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>设计模式 | LahmYing</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">设计模式</h1><a id="logo" href="/./archives">LahmYing</a><p class="description"></p></div><div id="nav-menu"><a href="/archives/"><i class="fa fa-archive">归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">设计模式</h1><div class="post-meta">2021-09-26</div><div class="post-content"><div class="toc"><ul><li><a href="#can-kao">参考</a></li><li><a href="#dan-li-mo-shi">单例模式</a><ul><li><a href="#ding-yi">定义</a></li></ul></li><li><a href="#ce-lue-mo-shi">策略模式</a><ul><li><a href="#ding-yi-1">定义</a></li><li><a href="#fen-chi">分离</a></li><li><a href="#zu-cheng">组成</a></li></ul></li><li><a href="#dai-li-mo-shi">代理模式</a><ul><li><a href="#bao-hu-dai-li">保护代理</a></li><li><a href="#xu-ni-dai-li">虚拟代理</a></li><li><a href="#huan-cun-dai-li">缓存代理</a></li></ul></li><li><a href="#die-dai-qi-mo-shi">迭代器模式</a></li><li><a href="#fa-bu-ding-yue-mo-shi">发布-订阅模式</a><ul><li><a href="#eg">eg</a></li><li><a href="#you-que-dian">优缺点</a></li></ul></li><li><a href="#ming-ling-mo-shi">命令模式</a><ul><li><a href="#shi-xian">实现</a></li></ul></li><li><a href="#zu-he-mo-shi">组合模式</a></li><li><a href="#mo-ban-fang-fa-mo-shi">模板方法模式</a></li><li><a href="#xiang-yuan-mo-shi">享元模式</a></li><li><a href="#zhi-ze-lian-mo-shi">职责链模式</a><ul><li><a href="#ding-yi-2">定义</a></li><li><a href="#he-xin">核心</a></li><li><a href="#shi-xian-1">实现</a></li></ul></li><li><a href="#zhong-jie-zhe-mo-shi">中介者模式</a><ul><li><a href="#ding-yi-3">定义</a></li><li><a href="#he-xin-1">核心</a></li><li><a href="#shi-xian-2">实现</a></li></ul></li><li><a href="#zhuang-shi-zhe-mo-shi">装饰者模式</a><ul><li><a href="#1-ding-yi">1. 定义</a></li><li><a href="#2-he-xin">2. 核心</a></li><li><a href="#3-shi-xian">3. 实现</a></li></ul></li><li><a href="#zhuang-tai-mo-shi">状态模式</a><ul><li><a href="#1-ding-yi-1">1. 定义</a></li><li><a href="#2-he-xin-1">2. 核心</a></li><li><a href="#3-shi-xian-1">3. 实现</a></li><li><a href="#4-you-que-dian">4. 优缺点</a></li></ul></li><li><a href="#shi-si-gua-pei-qi-mo-shi">十四、适配器模式</a><ul><li><a href="#ding-yi-4">定义</a></li><li><a href="#shi-xian-3">实现</a></li></ul></li><li><a href="#wai-guan-mo-shi">外观模式</a><ul><li><a href="#1-ding-yi-2">1. 定义</a></li><li><a href="#2-he-xin-2">2. 核心</a></li><li><a href="#3-shi-xian-2">3. 实现</a></li></ul></li></ul></div><h2><span id="can-kao">参考</span></h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46066237">JavaScript 中常见的十五种设计模式（上）</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46066651">JavaScript 中常见的十五种设计模式（下）</a></p><h2><span id="dan-li-mo-shi">单例模式</span></h2><h3><span id="ding-yi">定义</span></h3><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现方式</span></span><br><span class="line"><span class="comment">// 比如可以使用闭包缓存一个内部变量来实现这个单例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SetManager</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.manager = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SetManager.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.manager);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 后续写法 1</span></span><br><span class="line"><span class="comment">// let SingletonSetManager = (function() &#123;</span></span><br><span class="line"><span class="comment">//     let manager = null;</span></span><br><span class="line"><span class="comment">//     // 内部变量保存类的实例，存在则继续沿用这个实例</span></span><br><span class="line"><span class="comment">//     return function(name) &#123; // 传参给闭包函数 SingletonSetManager 的 name，其实是传给其 return 的函数</span></span><br><span class="line"><span class="comment">//         if (!manager) &#123;</span></span><br><span class="line"><span class="comment">//             manager = new SetManager(name);</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         return manager;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;)();</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;a&#x27;).getName(); // a</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;b&#x27;).getName(); // a</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;c&#x27;).getName(); // a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 后续写法 2</span></span><br><span class="line"><span class="comment">// 提取出通用的单例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSingleton</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      instance = fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 等于 this.fn(arguments)</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;arguments:  &quot;</span> + <span class="built_in">JSON</span>.stringify(<span class="built_in">arguments</span>)); <span class="comment">// arguments 直接可打印出来</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取单例</span></span><br><span class="line"><span class="keyword">let</span> managerSingleton = getSingleton(<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> manager = <span class="keyword">new</span> SetManager(name);</span><br><span class="line">  <span class="keyword">return</span> manager;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">managerSingleton(<span class="string">&quot;a&quot;</span>).getName(); <span class="comment">// a</span></span><br><span class="line">managerSingleton(<span class="string">&quot;b&quot;</span>).getName(); <span class="comment">// a</span></span><br><span class="line">managerSingleton(<span class="string">&quot;c&quot;</span>).getName(); <span class="comment">// a</span></span><br></pre></td></tr></table></figure><h2><span id="ce-lue-mo-shi">策略模式</span></h2><h3><span id="ding-yi">定义</span></h3><p>定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换</p><h3><span id="fen-chi">分离</span></h3><p><strong>使用</strong> ← 分离 → <strong>实现</strong></p><h3><span id="zu-cheng">组成</span></h3><ul><li><p>一组策略类，封装具体算法，负责具体计算</p></li><li><p>环境类 Context，Context 接受客户的请求，随后把请求委托给某一个策略类</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg：表单的验证方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误提示</span></span><br><span class="line"><span class="keyword">let</span> errorMsgs = &#123;</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">&quot;输入数据格式不正确&quot;</span>,</span><br><span class="line">  minLength: <span class="string">&quot;输入数据长度不足&quot;</span>,</span><br><span class="line">  isNumber: <span class="string">&quot;请输入数字&quot;</span>,</span><br><span class="line">  required: <span class="string">&quot;内容不为空&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规则集</span></span><br><span class="line"><span class="keyword">let</span> rules = &#123;</span><br><span class="line">  minLength: <span class="function"><span class="keyword">function</span> (<span class="params">value, length, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value.length &lt; length) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;minLength&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  isNumber: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/\d+/</span>.test(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;isNumber&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  required: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;required&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Validator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.items = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Validator</span>,</span><br><span class="line"></span><br><span class="line">  // 添加校验规则</span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params">value, rule, errorMsg</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arg = [value];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rule.indexOf(<span class="string">&quot;minLength&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> temp = rule.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      arg.push(temp[<span class="number">1</span>]);</span><br><span class="line">      rule = temp[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arg.push(errorMsg);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.items.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 进行校验</span></span><br><span class="line">      <span class="keyword">return</span> rules[rule].apply(<span class="built_in">this</span>, arg);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始校验</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.items.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">let</span> ret = <span class="built_in">this</span>.items[i]();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret);</span><br><span class="line">        <span class="comment">// return ret;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testTel</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> validate = <span class="keyword">new</span> Validator();</span><br><span class="line"></span><br><span class="line">validate.add(testTel(<span class="string">&quot;ccc&quot;</span>), <span class="string">&quot;isNumber&quot;</span>, <span class="string">&quot;只能为数字&quot;</span>); <span class="comment">// 只能为数字</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;&quot;</span>), <span class="string">&quot;required&quot;</span>); <span class="comment">// 内容不为空</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;123&quot;</span>), <span class="string">&quot;minLength:5&quot;</span>, <span class="string">&quot;最少5位&quot;</span>); <span class="comment">// 最少5位</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;12345&quot;</span>), <span class="string">&quot;minLength:5&quot;</span>, <span class="string">&quot;最少5位&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ret = validate.start();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ret);</span><br></pre></td></tr></table></figure><h2><span id="dai-li-mo-shi">代理模式</span></h2><h3><span id="bao-hu-dai-li">保护代理</span></h3><h3><span id="xu-ni-dai-li">虚拟代理</span></h3><p>在控制对主体的访问时，加入了一些额外的操作</p><h3><span id="huan-cun-dai-li">缓存代理</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 虚拟代理</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 函数节流：</span></span><br><span class="line"><span class="comment">   * mustRunDelay 时间内重复执行【延迟 delay 时间执行 fn】,到达 mustRunDelay 时间长度则马上执行 fn</span></span><br><span class="line"><span class="comment">   * eg: window.onscroll = throttle(fn, delay, mustRunDelay)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>fn  函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>delay 多久执行一次</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>mustRunDelay 执行时间间隔</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">throttle</span>(<span class="params">fn, delay, mustRunDelay</span>)</span> &#123;</span><br><span class="line">    <span class="comment">/*eslint-disable*/</span></span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> t_start</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> context = <span class="built_in">this</span>, args = <span class="built_in">arguments</span>, t_curr = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">      <span class="comment">// 清除定时操作</span></span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">      <span class="keyword">if</span> (!t_start) &#123;</span><br><span class="line">        t_start = t_curr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 时间间隔超过 mustRunDelay 则马上执行 fn</span></span><br><span class="line">      <span class="keyword">if</span> (t_curr - t_start &gt;= mustRunDelay) &#123;</span><br><span class="line">        fn.apply(context, args)</span><br><span class="line">        t_start = t_curr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 定义新的定时器，一段时间后进行操作</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          fn.apply(context, args)</span><br><span class="line">        &#125;, delay)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存代理</span></span><br><span class="line"><span class="comment">// 缓存加法操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arg = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="keyword">return</span> arg.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; a + b &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line"><span class="keyword">let</span> proxyAdd = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cache = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arg = [].slice.call(<span class="built_in">arguments</span>).join(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有，则直接从缓存返回</span></span><br><span class="line">    <span class="keyword">if</span> (cache[arg]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[arg];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> ret = add.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line"></span><br><span class="line">  proxyAdd(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>),</span><br><span class="line">  proxyAdd(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">); <span class="comment">// 10 10 100 100</span></span><br></pre></td></tr></table></figure><h2><span id="die-dai-qi-mo-shi">迭代器模式</span></h2><p>迭代器模式是指提供一种方法 <code>顺序访问</code> 一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示</p><p>在使用迭代器模式之后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现 ES6 的 迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> done = i &gt;= items.length;</span><br><span class="line">      <span class="keyword">let</span> value = !done ? items[i++] : <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> iterator = createIterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 1, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 2, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 3, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: undefined, done: true &#125;&quot;</span></span><br><span class="line"><span class="comment">// 之后的所有调用</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: undefined, done: true &#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器 eg</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year2000</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &lt;= <span class="number">2000</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year2100</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &gt;= <span class="number">2100</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &gt; <span class="number">2000</span> &amp;&amp; year &lt; <span class="number">2100</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iteratorYear</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> ret = <span class="built_in">arguments</span>[i]();</span><br><span class="line">    <span class="keyword">if</span> (ret !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> manager = iteratorYear(year2000, year2100, year); <span class="comment">// B</span></span><br></pre></td></tr></table></figure><h2><span id="fa-bu-ding-yue-mo-shi">发布-订阅模式</span></h2><p>也称作观察者模式</p><h3><span id="eg">eg</span></h3><p>小 A 在公司 C 完成了笔试及面试，小 B 也在公司 C 完成了笔试。他们焦急地等待结果，每隔半天就电话询问公司 C，导致公司 C 很不耐烦。</p><p>一种解决办法是 AB 直接把联系方式留给 C，有结果的话 C 自然会通知 AB</p><p>这里的询问属于显示 <code>调用</code>，留给属于 <code>订阅</code>，通知属于 <code>发布</code></p><h3><span id="you-que-dian">优缺点</span></h3><h4><span id="you">优</span></h4><p>一为时间上的解耦，二为对象之间的解耦</p><h4><span id="que">缺</span></h4><ul><li><p>创建订阅者本身要消耗一定的时间和内存，订阅的处理函数不一定会被执行，驻留内存有性能开销</p></li><li><p>弱化了对象之间的联系，复杂的情况下可能会导致程序难以跟踪维护和理解</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 观察者</span></span><br><span class="line"><span class="keyword">let</span> observer = &#123;</span><br><span class="line">  <span class="comment">// 订阅集合</span></span><br><span class="line">  subscribes: [],</span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.subscribes[type]) &#123;</span><br><span class="line">      <span class="built_in">this</span>.subscribes[type] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 收集订阅者针对订阅内容的处理函数</span></span><br><span class="line">    <span class="keyword">typeof</span> fn === <span class="string">&quot;function&quot;</span> &amp;&amp; <span class="built_in">this</span>.subscribes[type].push(fn);</span><br><span class="line">    <span class="comment">// log 为 bool, 但这种表达式有啥意义？</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布  可能会携带一些信息发布出去</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> type = [].shift.call(<span class="built_in">arguments</span>),</span><br><span class="line">      fns = <span class="built_in">this</span>.subscribes[type];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发布  &quot;</span>, fns);</span><br><span class="line">    <span class="comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span></span><br><span class="line">    <span class="keyword">if</span> (!fns || !fns.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 挨个处理调用</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fns.length; ++i) &#123;</span><br><span class="line">      fns[i].apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除订阅</span></span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 删除全部</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.subscribes = [];</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> fns = <span class="built_in">this</span>.subscribes[type];</span><br><span class="line">    <span class="comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span></span><br><span class="line">    <span class="keyword">if</span> (!fns || !fns.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      fns.length = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 挨个处理删除</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fns.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fns[i] === fn) &#123;</span><br><span class="line">        fns.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅岗位列表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobListForA</span>(<span class="params">jobs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>, jobs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobListForB</span>(<span class="params">jobs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>, jobs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;job&quot;</span>, jobListForA);</span><br><span class="line"><span class="comment">// B订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;job&quot;</span>, jobListForB);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;examinationA&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(score);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// B订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;examinationB&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(score);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了面试结果</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;interviewA&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;examinationA&quot;</span>, <span class="number">100</span>); <span class="comment">// 100</span></span><br><span class="line">observer.publish(<span class="string">&quot;examinationB&quot;</span>, <span class="number">80</span>); <span class="comment">// 80</span></span><br><span class="line">observer.publish(<span class="string">&quot;interviewA&quot;</span>, <span class="string">&quot;备用&quot;</span>); <span class="comment">// 备用</span></span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;job&quot;</span>, [<span class="string">&quot;前端&quot;</span>, <span class="string">&quot;后端&quot;</span>, <span class="string">&quot;测试&quot;</span>]); <span class="comment">// 输出A和B的岗位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// B取消订阅了笔试成绩</span></span><br><span class="line">observer.remove(<span class="string">&quot;examinationB&quot;</span>);</span><br><span class="line"><span class="comment">// A都取消订阅了岗位</span></span><br><span class="line">observer.remove(<span class="string">&quot;job&quot;</span>, jobListForA);</span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;examinationB&quot;</span>, <span class="number">80</span>); <span class="comment">// 没有可匹配的订阅，无输出</span></span><br><span class="line">observer.publish(<span class="string">&quot;job&quot;</span>, [<span class="string">&quot;前端&quot;</span>, <span class="string">&quot;后端&quot;</span>, <span class="string">&quot;测试&quot;</span>]); <span class="comment">// 输出B的岗位</span></span><br></pre></td></tr></table></figure><h2><span id="ming-ling-mo-shi">命令模式</span></h2><h3><span id="shi-xian">实现</span></h3><p>简单的命令模式实现可以直接使用 <code>对象字面量</code> 的形式定义一个命令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> incrementCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// something</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>采用对象创建处理的方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自增</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IncrementCommand</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当前值</span></span><br><span class="line">  <span class="built_in">this</span>.val = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 命令栈</span></span><br><span class="line">  <span class="built_in">this</span>.stack = [];</span><br><span class="line">  <span class="comment">// 栈指针位置</span></span><br><span class="line">  <span class="built_in">this</span>.stackPosition = -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IncrementCommand.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">IncrementCommand</span>,</span><br><span class="line"></span><br><span class="line">  // 执行</span><br><span class="line">  <span class="title">execute</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._clearRedo();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义执行的处理</span></span><br><span class="line">    <span class="keyword">let</span> command = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.val += <span class="number">2</span>;</span><br><span class="line">    &#125;.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行并缓存起来</span></span><br><span class="line">    command();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stack.push(command);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stackPosition++;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  canUndo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &gt;= <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  canRedo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &lt; <span class="built_in">this</span>.stack.length - <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 撤销</span></span><br><span class="line">  undo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canUndo()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stackPosition--;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 命令的撤销，与执行的处理相反</span></span><br><span class="line">    <span class="keyword">let</span> command = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.val -= <span class="number">2</span>;</span><br><span class="line">    &#125;.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 撤销后不需要缓存</span></span><br><span class="line">    command();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重做</span></span><br><span class="line">  redo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canRedo()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行栈顶的命令</span></span><br><span class="line">    <span class="built_in">this</span>.stack[++<span class="built_in">this</span>.stackPosition]();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在执行时，已经撤销的部分不能再重做</span></span><br><span class="line">  _clearRedo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.stack = <span class="built_in">this</span>.stack.slice(<span class="number">0</span>, <span class="built_in">this</span>.stackPosition + <span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前值</span></span><br><span class="line">  getValue: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.val);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2><span id="zu-he-mo-shi">组合模式</span></h2><p>使用组合模式来实现扫描文件夹中的文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件夹 组合对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Folder</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.parent = <span class="literal">null</span>;</span><br><span class="line">  <span class="built_in">this</span>.files = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folder.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Folder</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params">file</span>) &#123;</span><br><span class="line">    file.parent = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.files.push(file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  scan: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 委托给叶对象处理</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.files.length; ++i) &#123;</span><br><span class="line">      <span class="built_in">this</span>.files[i].scan();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span> (<span class="params">file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> file === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.files = [];</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.files.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.files[i] === file) &#123;</span><br><span class="line">        <span class="built_in">this</span>.files.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件 叶对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">File</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.parent = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">File</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件里面不能添加文件&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  scan: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name = [<span class="built_in">this</span>.name];</span><br><span class="line">    <span class="keyword">let</span> parent = <span class="built_in">this</span>.parent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">      name.unshift(parent.name);</span><br><span class="line">      parent = parent.parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(name.join(<span class="string">&quot; / &quot;</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>实例化，在组合对象中插入组合或叶对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> web = <span class="keyword">new</span> Folder(<span class="string">&quot;Web&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> fe = <span class="keyword">new</span> Folder(<span class="string">&quot;前端&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> css = <span class="keyword">new</span> Folder(<span class="string">&quot;CSS&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> js = <span class="keyword">new</span> Folder(<span class="string">&quot;js&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> rd = <span class="keyword">new</span> Folder(<span class="string">&quot;后端&quot;</span>);</span><br><span class="line"></span><br><span class="line">web.add(fe).add(rd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> file1 = <span class="keyword">new</span> File(<span class="string">&quot;HTML权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file2 = <span class="keyword">new</span> File(<span class="string">&quot;CSS权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file3 = <span class="keyword">new</span> File(<span class="string">&quot;JavaScript权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file4 = <span class="keyword">new</span> File(<span class="string">&quot;MySQL基础.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file5 = <span class="keyword">new</span> File(<span class="string">&quot;Web安全.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file6 = <span class="keyword">new</span> File(<span class="string">&quot;Linux菜鸟.pdf&quot;</span>);</span><br><span class="line"></span><br><span class="line">css.add(file2);</span><br><span class="line">fe.add(file1).add(file3).add(css).add(js);</span><br><span class="line">rd.add(file4).add(file5);</span><br><span class="line">web.add(file6);</span><br><span class="line"></span><br><span class="line">rd.remove(file4);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描</span></span><br><span class="line">web.scan();</span><br></pre></td></tr></table></figure><h2><span id="mo-ban-fang-fa-mo-shi">模板方法模式</span></h2><p>模板方法模式一般的实现方式为继承</p><p>以运动作为例子，运动有比较通用的一些处理，这部分可以抽离开来，在父类中实现。具体某项运动的特殊性则有自类来重写实现。</p><p>最终子类直接调用父类的模板函数来执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 体育运动</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sport</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Sport.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Sport</span>,</span><br><span class="line"></span><br><span class="line">  // 模板，按顺序执行</span><br><span class="line">  <span class="title">init</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.stretch();</span><br><span class="line">    <span class="built_in">this</span>.jog();</span><br><span class="line">    <span class="built_in">this</span>.deepBreath();</span><br><span class="line">    <span class="built_in">this</span>.start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> free = <span class="built_in">this</span>.end();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 运动后还有空的话，就拉伸一下</span></span><br><span class="line">    <span class="keyword">if</span> (free !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.stretch();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拉伸</span></span><br><span class="line">  stretch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;拉伸&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 慢跑</span></span><br><span class="line">  jog: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;慢跑&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深呼吸</span></span><br><span class="line">  deepBreath: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;深呼吸&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始运动</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;子类必须重写此方法&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结束运动</span></span><br><span class="line">  end: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运动结束&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 篮球</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Basketball</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Basketball.prototype = <span class="keyword">new</span> Sport();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写相关的方法</span></span><br><span class="line">Basketball.prototype.start = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;先投上几个三分&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Basketball.prototype.end = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;运动结束了，有事先走一步&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 马拉松</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Marathon</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Marathon.prototype = <span class="keyword">new</span> Sport();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> basketball = <span class="keyword">new</span> Basketball();</span><br><span class="line"><span class="keyword">let</span> marathon = <span class="keyword">new</span> Marathon();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类调用，最终会按照父类定义的顺序执行</span></span><br><span class="line">basketball.init();</span><br><span class="line">marathon.init();</span><br></pre></td></tr></table></figure><h2><span id="xiang-yuan-mo-shi">享元模式</span></h2><p>享元（flyweight）模式是一种用于性能优化的模式，它的目标是尽量减少共享对象的数量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 健康测量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fitness</span>(<span class="params">sex</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂，创建可共享的对象</span></span><br><span class="line"><span class="keyword">let</span> FitnessFactory = &#123;</span><br><span class="line">  objs: [],</span><br><span class="line"></span><br><span class="line">  create: <span class="function"><span class="keyword">function</span> (<span class="params">sex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.objs[sex]) &#123;</span><br><span class="line">      <span class="built_in">this</span>.objs[sex] = <span class="keyword">new</span> Fitness(sex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.objs[sex];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理器，管理非共享的部分</span></span><br><span class="line"><span class="keyword">let</span> FitnessManager = &#123;</span><br><span class="line">  fitnessData: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加一项</span></span><br><span class="line">  add: <span class="function"><span class="keyword">function</span> (<span class="params">name, sex, age, height, weight</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fitness = FitnessFactory.create(sex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存储变化的数据</span></span><br><span class="line">    <span class="built_in">this</span>.fitnessData[name] = &#123;</span><br><span class="line">      age: age,</span><br><span class="line">      height: height,</span><br><span class="line">      weight: weight,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fitness;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从存储的数据中获取，更新至当前正在使用的对象</span></span><br><span class="line">  updateFitnessData: <span class="function"><span class="keyword">function</span> (<span class="params">name, obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fitnessData = <span class="built_in">this</span>.fitnessData[name];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> fitnessData) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fitnessData.hasOwnProperty(item)) &#123;</span><br><span class="line">        obj[item] = fitnessData[item];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始评判</span></span><br><span class="line">Fitness.prototype.judge = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 操作前先更新当前状态（从外部状态管理器中获取）</span></span><br><span class="line">  FitnessManager.updateFitnessData(name, <span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ret = name + <span class="string">&quot;: &quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.sex === <span class="string">&quot;male&quot;</span>) &#123;</span><br><span class="line">    ret += <span class="built_in">this</span>.judgeMale();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ret += <span class="built_in">this</span>.judgeFemale();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(ret);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 男性评判规则</span></span><br><span class="line">Fitness.prototype.judgeMale = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="built_in">this</span>.height / <span class="built_in">this</span>.weight;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.age &gt; <span class="number">20</span> ? ratio &gt; <span class="number">3.5</span> : ratio &gt; <span class="number">2.8</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 女性评判规则</span></span><br><span class="line">Fitness.prototype.judgeFemale = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="built_in">this</span>.height / <span class="built_in">this</span>.weight;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.age &gt; <span class="number">20</span> ? ratio &gt; <span class="number">4</span> : ratio &gt; <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = FitnessManager.add(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">18</span>, <span class="number">160</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">let</span> b = FitnessManager.add(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">21</span>, <span class="number">180</span>, <span class="number">70</span>);</span><br><span class="line"><span class="keyword">let</span> c = FitnessManager.add(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">28</span>, <span class="number">160</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">let</span> d = FitnessManager.add(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">18</span>, <span class="number">170</span>, <span class="number">60</span>);</span><br><span class="line"><span class="keyword">let</span> e = FitnessManager.add(<span class="string">&quot;E&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">18</span>, <span class="number">160</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始评判</span></span><br><span class="line">a.judge(<span class="string">&quot;A&quot;</span>); <span class="comment">// A: false</span></span><br><span class="line">b.judge(<span class="string">&quot;B&quot;</span>); <span class="comment">// B: false</span></span><br><span class="line">c.judge(<span class="string">&quot;C&quot;</span>); <span class="comment">// C: false</span></span><br><span class="line">d.judge(<span class="string">&quot;D&quot;</span>); <span class="comment">// D: true</span></span><br><span class="line">e.judge(<span class="string">&quot;E&quot;</span>); <span class="comment">// E: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// factory对象有点像单例模式，只是多了一个sex的参数，如果没有内部状态，则没有参数的factory对象就更接近单例模式了</span></span><br></pre></td></tr></table></figure><h2><span id="zhi-ze-lian-mo-shi">职责链模式</span></h2><h3><span id="ding-yi">定义</span></h3><p>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系，将这些对象连成一条链，并沿着这条链 传递该请求，直到有一个对象处理</p><p>它为止</p><h3><span id="he-xin">核心</span></h3><p>请求发送者只需要知道链中的第一个节点，弱化发送者和一组接收者之间的强联系，可以便捷地在职责链中增加或删除一个节点，同样地，指定谁是第一个节</p><p>点也很便捷</p><h3><span id="shi-xian">实现</span></h3><p>展示不同类型的变量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义链的某一项</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChainItem</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.fn = fn;</span><br><span class="line">  <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ChainItem.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">ChainItem</span>,</span><br><span class="line"></span><br><span class="line">  // 设置下一项</span><br><span class="line">  <span class="title">setNext</span>: <span class="title">function</span> (<span class="params">next</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.next = next;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;next:  &quot;</span> + next);</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始执行</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 转到链的下一项执行</span></span><br><span class="line">  toNext: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.next) &#123;</span><br><span class="line">      <span class="built_in">this</span>.start.apply(<span class="built_in">this</span>.next, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;无匹配的执行项目&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示数字</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showNumber</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;number&quot;</span>, num);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 转移到下一项</span></span><br><span class="line">    <span class="built_in">this</span>.toNext(num);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;数字后下一步&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showString</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;string&quot;</span>, str);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;object&quot;</span>, obj);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> chainNumber = <span class="keyword">new</span> ChainItem(showNumber);</span><br><span class="line"><span class="keyword">let</span> chainString = <span class="keyword">new</span> ChainItem(showString);</span><br><span class="line"><span class="keyword">let</span> chainObject = <span class="keyword">new</span> ChainItem(showObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置链条</span></span><br><span class="line"><span class="keyword">let</span> next1 = chainObject.setNext(chainNumber);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;next1:  &quot;</span> + <span class="built_in">JSON</span>.stringify(next1)); <span class="comment">// next1:  &#123;&quot;next&quot;:&#123;&quot;next&quot;:null&#125;&#125;</span></span><br><span class="line"><span class="keyword">let</span> next2 = next1.setNext(chainString);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;next2:  &quot;</span> + <span class="built_in">JSON</span>.stringify(next2)); <span class="comment">// &#123;&quot;next&quot;:null&#125;</span></span><br><span class="line"></span><br><span class="line">chainString.start(<span class="string">&quot;12&quot;</span>); <span class="comment">// string 12</span></span><br><span class="line">chainNumber.start(&#123;&#125;); <span class="comment">// 无匹配的执行项目</span></span><br><span class="line">chainObject.start(&#123;&#125;); <span class="comment">// object &#123;&#125;</span></span><br><span class="line">chainObject.start(<span class="number">123</span>); <span class="comment">// number 123</span></span><br></pre></td></tr></table></figure><p>这时想判断未定义的时候呢，直接加到链中即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展示未定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showUndefined</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;undefined&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> chainUndefined = <span class="keyword">new</span> ChainItem(showUndefined);</span><br><span class="line">chainString.setNext(chainUndefined);</span><br><span class="line"></span><br><span class="line">chainNumber.start(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><code>对象增多，结构更清晰，一定程度上可能影响性能，注意避免过长的职责链</code></p><h2><span id="zhong-jie-zhe-mo-shi">中介者模式</span></h2><h3><span id="ding-yi">定义</span></h3><p>所有的相关 对象都通过中介者对象来通信，而不是互相引用，所以当一个对象发生改变时，只需要通知中介者对象即可</p><h3><span id="he-xin">核心</span></h3><p>使网状的多对多关系变成了相对简单的一对多关系（复杂的调度处理都交给中介者）</p><h3><span id="shi-xian">实现</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = &#123;</span><br><span class="line">  score: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自己获取</span></span><br><span class="line">    <span class="built_in">this</span>.getRank();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 直接获取</span></span><br><span class="line">  getRank: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> scores = [<span class="built_in">this</span>.score, B.score, C.score].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a &lt; b;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(scores.indexOf(<span class="built_in">this</span>.score) + <span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> B = &#123;</span><br><span class="line">  score: <span class="number">20</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过中介者获取</span></span><br><span class="line">    rankMediator(B);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> C = &#123;</span><br><span class="line">  score: <span class="number">30</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    rankMediator(C);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者，计算排名</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rankMediator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> scores = [A.score, B.score, C.score].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(scores.indexOf(person.score) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A通过自身来处理</span></span><br><span class="line">A.changeTo(<span class="number">100</span>); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// B和C交由中介者处理</span></span><br><span class="line">B.changeTo(<span class="number">200</span>); <span class="comment">// 1</span></span><br><span class="line">C.changeTo(<span class="number">50</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>虽然中介者做到了对模块和对象的解耦，但有时对象之间的关系并非一定要解耦，强行使用中介者来整合，可能会使代码更为繁琐，需要注意</p><h2><span id="zhuang-shi-zhe-mo-shi">装饰者模式</span></h2><h3><span id="1-ding-yi">1. 定义</span></h3><p>以动态地给某个对象添加一些额外的职责，而不会影响从这个类中派生的其他对象。<br>是一种“即用即付”的方式，能够在不改变对 象自身的基础上，在程序运行期间给对象动态地 添加职责</p><h3><span id="2-he-xin">2. 核心</span></h3><p>是为对象动态加入行为，经过多重包装，可以形成一条装饰链</p><h3><span id="3-shi-xian">3. 实现</span></h3><p>最简单的装饰者，就是重写对象的属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = &#123;</span><br><span class="line">  score: <span class="number">10</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A.score = <span class="string">&quot;分数：&quot;</span> + A.score;</span><br></pre></td></tr></table></figure><p>可以使用传统面向对象的方法来实现装饰，添加技能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;数学&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器，还会音乐</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MusicDecorator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MusicDecorator.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person.skill();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器，还会跑步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RunDecorator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RunDecorator.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person.skill();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰一下</span></span><br><span class="line"><span class="keyword">let</span> person1 = <span class="keyword">new</span> MusicDecorator(person);</span><br><span class="line">person1 = <span class="keyword">new</span> RunDecorator(person1);</span><br><span class="line"></span><br><span class="line">person.skill(); <span class="comment">// 数学</span></span><br><span class="line">person1.skill(); <span class="comment">// 数学 音乐 跑步</span></span><br></pre></td></tr></table></figure><p><code>更简洁的写法</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装饰器，在当前函数执行前先执行另一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decoratorBefore</span>(<span class="params">fn, beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> ret = beforeFn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在前一个函数中判断，不需要执行当前函数</span></span><br><span class="line">    <span class="keyword">if</span> (ret !== <span class="literal">false</span>) &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;数学&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skillMusic</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skillRun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> skillDecorator = decoratorBefore(skill, skillMusic);</span><br><span class="line">skillDecorator = decoratorBefore(skillDecorator, skillRun);</span><br><span class="line"></span><br><span class="line">skillDecorator(); <span class="comment">// 跑步 音乐 数学</span></span><br></pre></td></tr></table></figure><h2><span id="zhuang-tai-mo-shi">状态模式</span></h2><h3><span id="1-ding-yi">1. 定义</span></h3><p>事物内部状态的改变往往会带来事物的行为改变。在处理的时候，将这个处理委托给当前的 <code>状态对象</code> 即可，该状态对象会负责渲染它自身的行为</p><h3><span id="2-he-xin">2. 核心</span></h3><p>区分事物内部的状态，把事物的每种状态都封装成单独的类，跟此种状态有关的行为都被封装在这个类的内部</p><h3><span id="3-shi-xian">3. 实现</span></h3><p>以一个人的工作状态作为例子，在刚醒、精神、疲倦几个状态中切换着</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工作状态</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Work</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.currentState = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 工作状态，保存为对应状态对象</span></span><br><span class="line">  <span class="built_in">this</span>.wakeUpState = <span class="keyword">new</span> WakeUpState(<span class="built_in">this</span>);</span><br><span class="line">  <span class="comment">// 精神饱满</span></span><br><span class="line">  <span class="built_in">this</span>.energeticState = <span class="keyword">new</span> EnergeticState(<span class="built_in">this</span>);</span><br><span class="line">  <span class="comment">// 疲倦</span></span><br><span class="line">  <span class="built_in">this</span>.tiredState = <span class="keyword">new</span> TiredState(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Work.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.currentState = <span class="built_in">this</span>.wakeUpState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点击事件，用于触发更新状态</span></span><br><span class="line">  <span class="built_in">document</span>.body.onclick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentState.behaviour();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新工作状态</span></span><br><span class="line">Work.prototype.setState = <span class="function"><span class="keyword">function</span> (<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.currentState = state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刚醒</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WakeUpState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刚醒的行为</span></span><br><span class="line">WakeUpState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;刚醒呢，睡个懒觉先&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 只睡了2秒钟懒觉就精神了..</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.energeticState);</span><br><span class="line">  &#125;, <span class="number">2</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 精神饱满</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">EnergeticState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EnergeticState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;超级精神的&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 才精神1秒钟就发困了</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.tiredState);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 疲倦</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TiredState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TiredState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;怎么肥事，好困&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不知不觉，又变成了刚醒着的状态... 不断循环呀</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.wakeUpState);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> work = <span class="keyword">new</span> Work(<span class="string">&quot;曹操&quot;</span>);</span><br></pre></td></tr></table></figure><h3><span id="4-you-que-dian">4. 优缺点</span></h3><h4><span id="you-dian">优点</span></h4><p>状态切换逻辑分布在状态类中，易于维护</p><h4><span id="que-dian">缺点</span></h4><p>多个状态类，影响性能，可用享元模式进一步优化</p><p>将逻辑分散在状态类中，不易看出状态机变化逻辑</p><h2><span id="shi-si-gua-pei-qi-mo-shi">十四、适配器模式</span></h2><h3><span id="ding-yi">定义</span></h3><p>是解决两个软件实体间的接口不兼容的问题，对不兼容的部分进行适配</p><h3><span id="shi-xian">实现</span></h3><p>比如一个简单的数据格式转换的适配器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染数据，格式限制为数组了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  data.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对非数组的进行转换适配</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayAdapter</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(data) === <span class="string">&quot;[object Array]&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> temp = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="comment">// hasOwnProperty() 方法会返回一个布尔值，指示对象自身属性中是否具有指定的属性（也就是，是否有指定的键）</span></span><br><span class="line">    <span class="comment">// 原型链上继承过来的属性无法通过 hasOwnProperty 检测到</span></span><br><span class="line">    <span class="keyword">if</span> (data.hasOwnProperty(item)) &#123;</span><br><span class="line">      temp.push(data[item]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">renderData(arrayAdapter(data)); <span class="comment">// A B C</span></span><br></pre></td></tr></table></figure><h2><span id="wai-guan-mo-shi">外观模式</span></h2><h3><span id="1-ding-yi">1. 定义</span></h3><p>为子系统中的<code>一组接口</code>提供一个<code>一致的界面</code>，定义一个<code>高层接口</code>，这个接口使子系统更加容易使用</p><h3><span id="2-he-xin">2. 核心</span></h3><p>可以通过请求外观接口来达到访问子系统，也可以选择越过外观来直接访问子系统</p><h3><span id="3-shi-xian">3. 实现</span></h3><p>外观模式在 JS 中，可以认为是一组函数的集合</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三个处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doing</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;doing&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观函数，将一些处理统一起来，方便调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  start();</span><br><span class="line">  doing();</span><br><span class="line">  end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用init开始执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 此处直接调用了高层函数，也可以选择越过它直接调用相关的函数</span></span><br><span class="line">  execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">init(); <span class="comment">// start doing end</span></span><br></pre></td></tr></table></figure></div><div class="tags"><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><i class="fa fa-tag"></i>设计模式</a></div><div class="post-nav"><a class="pre" href="/2021/09/28/%E8%84%9A%E6%89%8B%E6%9E%B6/">脚手架</a><a class="next" href="/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">应用架构模式</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">标签</i></div><div class="tagcloud"><a href="/tags/css/" style="font-size:15px">css</a> <a href="/tags/CI-CD/" style="font-size:15px">CI/CD</a> <a href="/tags/%E6%8E%A5%E5%8F%A3/" style="font-size:15px">接口</a> <a href="/tags/SEO/" style="font-size:15px">SEO</a> <a href="/tags/typescript/" style="font-size:15px">typescript</a> <a href="/tags/gulp/" style="font-size:15px">gulp</a> <a href="/tags/vue/" style="font-size:15px">vue</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" style="font-size:15px">网络运维</a> <a href="/tags/cookie/" style="font-size:15px">cookie</a> <a href="/tags/echarts/" style="font-size:15px">echarts</a> <a href="/tags/git/" style="font-size:15px">git</a> <a href="/tags/html/" style="font-size:15px">html</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size:15px">浏览器</a> <a href="/tags/http/" style="font-size:15px">http</a> <a href="/tags/js/" style="font-size:15px">js</a> <a href="/tags/linux/" style="font-size:15px">linux</a> <a href="/tags/node-js/" style="font-size:15px">node.js</a> <a href="/tags/%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86/" style="font-size:15px">依赖管理</a> <a href="/tags/WebApp/" style="font-size:15px">WebApp</a> <a href="/tags/webpack/" style="font-size:15px">webpack</a> <a href="/tags/docker/" style="font-size:15px">docker</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size:15px">建站</a> <a href="/tags/%E4%BC%98%E5%8C%96/" style="font-size:15px">优化</a> <a href="/tags/%E7%BB%84%E4%BB%B6/" style="font-size:15px">组件</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size:15px">其他</a> <a href="/tags/vim/" style="font-size:15px">vim</a> <a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size:15px">安全</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size:15px">缓存</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size:15px">跨域</a> <a href="/tags/%E9%80%82%E9%85%8D/" style="font-size:15px">适配</a> <a href="/tags/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84/" style="font-size:15px">应用架构</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:15px">数据结构</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size:15px">测试</a> <a href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6/" style="font-size:15px">脚手架</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size:15px">调试</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:15px">设计模式</a> <a href="/tags/vuex/" style="font-size:15px">vuex</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link">链接</i></div><ul></ul><a href="https://github.com/LahmYing" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022 LahmYing. Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path="search.xml",path="/"+(search_path=0==search_path.length?"search.xml":search_path);searchFunc(path,"local-search-input","local-search-result")</script><script type="text/javascript" src="/js/love.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>