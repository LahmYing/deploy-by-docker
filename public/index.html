<!DOCTYPE html><html><head><meta charset="utf-8"><title>lahmying</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:type" content="website"><meta property="og:title" content="lahmying"><meta property="og:url" content="http://example.com/index.html"><meta property="og:site_name" content="lahmying"><meta property="og:locale"><meta property="article:author" content="lanying"><meta name="twitter:card" content="summary"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/style.css"><!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]--><meta name="generator" content="Hexo 5.4.0"></head><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">lahmying</a></h1></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-search-btn" class="nav-icon" title="Search"></a></nav><div id="search-form-wrap"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form"><input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search"> <input type="submit" value="" class="search-form-submit"> <input name="tn" type="hidden" value="bds"> <input name="cl" type="hidden" value="3"> <input name="ct" type="hidden" value="2097152"> <input type="hidden" name="si" value="example.com"></form></div></div></div></header><div class="outer"><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Tag Cloud</h3><div class="widget tagcloud"><a href="/tags/SEO/" style="font-size:10px">SEO</a> <a href="/tags/Typescript/" style="font-size:10px">Typescript</a> <a href="/tags/cookie/" style="font-size:10px">cookie</a> <a href="/tags/css/" style="font-size:15px">css</a> <a href="/tags/docker/" style="font-size:15px">docker</a> <a href="/tags/echarts/" style="font-size:10px">echarts</a> <a href="/tags/git/" style="font-size:10px">git</a> <a href="/tags/githook/" style="font-size:10px">githook</a> <a href="/tags/gulp/" style="font-size:10px">gulp</a> <a href="/tags/html/" style="font-size:12.5px">html</a> <a href="/tags/js/" style="font-size:15px">js</a> <a href="/tags/npm/" style="font-size:12.5px">npm</a> <a href="/tags/vim/" style="font-size:10px">vim</a> <a href="/tags/vue/" style="font-size:17.5px">vue</a> <a href="/tags/vue-Typescript/" style="font-size:10px">vue+Typescript</a> <a href="/tags/yarn/" style="font-size:10px">yarn</a> <a href="/tags/%E5%85%B6%E4%BB%96/" style="font-size:12.5px">其他</a> <a href="/tags/%E5%90%8E%E7%AB%AF%E7%9B%B8%E5%85%B3/" style="font-size:10px">后端相关</a> <a href="/tags/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84/" style="font-size:10px">应用架构</a> <a href="/tags/%E5%BB%BA%E7%AB%99/" style="font-size:10px">建站</a> <a href="/tags/%E6%8E%A5%E5%8F%A3%E9%A3%8E%E6%A0%BC/" style="font-size:10px">接口风格</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:10px">数据结构</a> <a href="/tags/%E6%9E%84%E5%BB%BA/" style="font-size:12.5px">构建</a> <a href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="font-size:10px">浏览器</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" style="font-size:12.5px">移动端</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" style="font-size:20px">网络运维</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:10px">设计模式</a> <a href="/tags/%E8%B0%83%E8%AF%95/" style="font-size:10px">调试</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size:10px">跨域</a> <a href="/tags/%E8%B7%AF%E7%94%B1/" style="font-size:10px">路由</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size:10px">项目</a></div></div></aside><section id="main"><article id="post-路由" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/28/%E8%B7%AF%E7%94%B1/" class="article-date"><time datetime="2021-09-28T09:11:58.000Z" itemprop="datePublished">2021-09-28</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/28/%E8%B7%AF%E7%94%B1/">路由</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#popstate-shi-jian-jian-ting-liu-lan-qi-li-shi-de-gai-bian">popstate 事件-监听浏览器历史的改变</a></li></ul></div><h1><a href="#popstate-shi-jian-jian-ting-liu-lan-qi-li-shi-de-gai-bian" class="header-anchor">#</a><span id="popstate-shi-jian-jian-ting-liu-lan-qi-li-shi-de-gai-bian">popstate 事件-监听浏览器历史的改变</span></h1><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event</a></p><p>调用 history.pushState()或 history.replaceState()不会触发 popstate 事件。<br>只有在做出浏览器动作时，才会触发该事件，如用户点击浏览器的回退按钮（或者在 Javascript 代码中调用 history.back()或者 history.forward()方法）</p></div><footer class="article-footer"><a data-url="http://example.com/2021/09/28/%E8%B7%AF%E7%94%B1/" data-id="cku5jkixf00367h0cdqgk2o8l" class="article-share-link">Share</a> <a href="http://example.com/2021/09/28/%E8%B7%AF%E7%94%B1/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%B7%AF%E7%94%B1/" rel="tag">路由</a></li></ul></footer></div></article><article id="post-构建" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/28/%E6%9E%84%E5%BB%BA/" class="article-date"><time datetime="2021-09-28T08:16:56.000Z" itemprop="datePublished">2021-09-28</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/28/%E6%9E%84%E5%BB%BA/">构建</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#zi-da-qian-duan-jiao-shou-jia">自搭前端脚手架</a></li></ul></div><h1><a href="#zi-da-qian-duan-jiao-shou-jia" class="header-anchor">#</a><span id="zi-da-qian-duan-jiao-shou-jia">自搭前端脚手架</span></h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/55addf3cbbbd">https://www.jianshu.com/p/55addf3cbbbd</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000006190814">https://segmentfault.com/a/1190000006190814</a></p></div><footer class="article-footer"><a data-url="http://example.com/2021/09/28/%E6%9E%84%E5%BB%BA/" data-id="cku5jkiwi001h7h0cd5kdd392" class="article-share-link">Share</a> <a href="http://example.com/2021/09/28/%E6%9E%84%E5%BB%BA/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9E%84%E5%BB%BA/" rel="tag">构建</a></li></ul></footer></div></article><article id="post-设计模式" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date"><time datetime="2021-09-26T06:05:41.000Z" itemprop="datePublished">2021-09-26</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#can-kao">参考</a></li><li><a href="#dan-li-mo-shi">单例模式</a><ul><li><a href="#ding-yi">定义</a></li></ul></li><li><a href="#ce-lue-mo-shi">策略模式</a><ul><li><a href="#ding-yi-1">定义</a></li><li><a href="#fen-chi">分离</a></li><li><a href="#zu-cheng">组成</a></li></ul></li><li><a href="#dai-li-mo-shi">代理模式</a><ul><li><a href="#bao-hu-dai-li">保护代理</a></li><li><a href="#xu-ni-dai-li">虚拟代理</a></li><li><a href="#huan-cun-dai-li">缓存代理</a></li></ul></li><li><a href="#die-dai-qi-mo-shi">迭代器模式</a></li><li><a href="#fa-bu-ding-yue-mo-shi">发布-订阅模式</a><ul><li><a href="#eg">eg</a></li><li><a href="#you-que-dian">优缺点</a></li></ul></li><li><a href="#ming-ling-mo-shi">命令模式</a><ul><li><a href="#shi-xian">实现</a></li></ul></li><li><a href="#zu-he-mo-shi">组合模式</a></li><li><a href="#mo-ban-fang-fa-mo-shi">模板方法模式</a></li><li><a href="#xiang-yuan-mo-shi">享元模式</a></li><li><a href="#zhi-ze-lian-mo-shi">职责链模式</a><ul><li><a href="#ding-yi-2">定义</a></li><li><a href="#he-xin">核心</a></li><li><a href="#shi-xian-1">实现</a></li></ul></li><li><a href="#zhong-jie-zhe-mo-shi">中介者模式</a><ul><li><a href="#ding-yi-3">定义</a></li><li><a href="#he-xin-1">核心</a></li><li><a href="#shi-xian-2">实现</a></li></ul></li><li><a href="#zhuang-shi-zhe-mo-shi">装饰者模式</a><ul><li><a href="#1-ding-yi">1. 定义</a></li><li><a href="#2-he-xin">2. 核心</a></li><li><a href="#3-shi-xian">3. 实现</a></li></ul></li><li><a href="#zhuang-tai-mo-shi">状态模式</a><ul><li><a href="#1-ding-yi-1">1. 定义</a></li><li><a href="#2-he-xin-1">2. 核心</a></li><li><a href="#3-shi-xian-1">3. 实现</a></li><li><a href="#4-you-que-dian">4. 优缺点</a></li></ul></li><li><a href="#shi-si-gua-pei-qi-mo-shi">十四、适配器模式</a><ul><li><a href="#ding-yi-4">定义</a></li><li><a href="#shi-xian-3">实现</a></li></ul></li><li><a href="#wai-guan-mo-shi">外观模式</a><ul><li><a href="#1-ding-yi-2">1. 定义</a></li><li><a href="#2-he-xin-2">2. 核心</a></li><li><a href="#3-shi-xian-2">3. 实现</a></li></ul></li></ul></div><h2><a href="#can-kao" class="header-anchor">#</a><span id="can-kao">参考</span></h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46066237">JavaScript 中常见的十五种设计模式（上）</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/46066651">JavaScript 中常见的十五种设计模式（下）</a></p><h2><a href="#dan-li-mo-shi" class="header-anchor">#</a><span id="dan-li-mo-shi">单例模式</span></h2><h3><a href="#ding-yi" class="header-anchor">#</a><span id="ding-yi">定义</span></h3><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现方式</span></span><br><span class="line"><span class="comment">// 比如可以使用闭包缓存一个内部变量来实现这个单例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SetManager</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.manager = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SetManager.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.manager);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 后续写法 1</span></span><br><span class="line"><span class="comment">// let SingletonSetManager = (function() &#123;</span></span><br><span class="line"><span class="comment">//     let manager = null;</span></span><br><span class="line"><span class="comment">//     // 内部变量保存类的实例，存在则继续沿用这个实例</span></span><br><span class="line"><span class="comment">//     return function(name) &#123; // 传参给闭包函数 SingletonSetManager 的 name，其实是传给其 return 的函数</span></span><br><span class="line"><span class="comment">//         if (!manager) &#123;</span></span><br><span class="line"><span class="comment">//             manager = new SetManager(name);</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         return manager;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;)();</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;a&#x27;).getName(); // a</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;b&#x27;).getName(); // a</span></span><br><span class="line"><span class="comment">// SingletonSetManager(&#x27;c&#x27;).getName(); // a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 后续写法 2</span></span><br><span class="line"><span class="comment">// 提取出通用的单例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSingleton</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!instance) &#123;</span><br><span class="line">      instance = fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>); <span class="comment">// 等于 this.fn(arguments)</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;arguments:  &quot;</span> + <span class="built_in">JSON</span>.stringify(<span class="built_in">arguments</span>)); <span class="comment">// arguments 直接可打印出来</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取单例</span></span><br><span class="line"><span class="keyword">let</span> managerSingleton = getSingleton(<span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> manager = <span class="keyword">new</span> SetManager(name);</span><br><span class="line">  <span class="keyword">return</span> manager;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">managerSingleton(<span class="string">&quot;a&quot;</span>).getName(); <span class="comment">// a</span></span><br><span class="line">managerSingleton(<span class="string">&quot;b&quot;</span>).getName(); <span class="comment">// a</span></span><br><span class="line">managerSingleton(<span class="string">&quot;c&quot;</span>).getName(); <span class="comment">// a</span></span><br></pre></td></tr></table></figure><h2><a href="#ce-lue-mo-shi" class="header-anchor">#</a><span id="ce-lue-mo-shi">策略模式</span></h2><h3><a href="#ding-yi" class="header-anchor">#</a><span id="ding-yi">定义</span></h3><p>定义一系列的算法，把它们一个个封装起来，并且使它们可以相互替换</p><h3><a href="#fen-chi" class="header-anchor">#</a><span id="fen-chi">分离</span></h3><p><strong>使用</strong> ← 分离 → <strong>实现</strong></p><h3><a href="#zu-cheng" class="header-anchor">#</a><span id="zu-cheng">组成</span></h3><ul><li><p>一组策略类，封装具体算法，负责具体计算</p></li><li><p>环境类 Context，Context 接受客户的请求，随后把请求委托给某一个策略类</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eg：表单的验证方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误提示</span></span><br><span class="line"><span class="keyword">let</span> errorMsgs = &#123;</span><br><span class="line">  <span class="keyword">default</span>: <span class="string">&quot;输入数据格式不正确&quot;</span>,</span><br><span class="line">  minLength: <span class="string">&quot;输入数据长度不足&quot;</span>,</span><br><span class="line">  isNumber: <span class="string">&quot;请输入数字&quot;</span>,</span><br><span class="line">  required: <span class="string">&quot;内容不为空&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规则集</span></span><br><span class="line"><span class="keyword">let</span> rules = &#123;</span><br><span class="line">  minLength: <span class="function"><span class="keyword">function</span> (<span class="params">value, length, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value.length &lt; length) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;minLength&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  isNumber: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/\d+/</span>.test(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;isNumber&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  required: <span class="function"><span class="keyword">function</span> (<span class="params">value, errorMsg</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> errorMsg || errorMsgs[<span class="string">&quot;required&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 校验器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Validator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.items = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Validator.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Validator</span>,</span><br><span class="line"></span><br><span class="line">  // 添加校验规则</span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params">value, rule, errorMsg</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arg = [value];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rule.indexOf(<span class="string">&quot;minLength&quot;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> temp = rule.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">      arg.push(temp[<span class="number">1</span>]);</span><br><span class="line">      rule = temp[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    arg.push(errorMsg);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.items.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 进行校验</span></span><br><span class="line">      <span class="keyword">return</span> rules[rule].apply(<span class="built_in">this</span>, arg);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始校验</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.items.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">let</span> ret = <span class="built_in">this</span>.items[i]();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (ret) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(ret);</span><br><span class="line">        <span class="comment">// return ret;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试数据</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testTel</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> validate = <span class="keyword">new</span> Validator();</span><br><span class="line"></span><br><span class="line">validate.add(testTel(<span class="string">&quot;ccc&quot;</span>), <span class="string">&quot;isNumber&quot;</span>, <span class="string">&quot;只能为数字&quot;</span>); <span class="comment">// 只能为数字</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;&quot;</span>), <span class="string">&quot;required&quot;</span>); <span class="comment">// 内容不为空</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;123&quot;</span>), <span class="string">&quot;minLength:5&quot;</span>, <span class="string">&quot;最少5位&quot;</span>); <span class="comment">// 最少5位</span></span><br><span class="line">validate.add(testTel(<span class="string">&quot;12345&quot;</span>), <span class="string">&quot;minLength:5&quot;</span>, <span class="string">&quot;最少5位&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ret = validate.start();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(ret);</span><br></pre></td></tr></table></figure><h2><a href="#dai-li-mo-shi" class="header-anchor">#</a><span id="dai-li-mo-shi">代理模式</span></h2><h3><a href="#bao-hu-dai-li" class="header-anchor">#</a><span id="bao-hu-dai-li">保护代理</span></h3><h3><a href="#xu-ni-dai-li" class="header-anchor">#</a><span id="xu-ni-dai-li">虚拟代理</span></h3><p>在控制对主体的访问时，加入了一些额外的操作</p><h3><a href="#huan-cun-dai-li" class="header-anchor">#</a><span id="huan-cun-dai-li">缓存代理</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 虚拟代理</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 函数节流：</span></span><br><span class="line"><span class="comment">   * mustRunDelay 时间内重复执行【延迟 delay 时间执行 fn】,到达 mustRunDelay 时间长度则马上执行 fn</span></span><br><span class="line"><span class="comment">   * eg: window.onscroll = throttle(fn, delay, mustRunDelay)</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>fn  函数</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>delay 多久执行一次</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param </span>mustRunDelay 执行时间间隔</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return <span class="type">&#123;Function&#125;</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="title">throttle</span>(<span class="params">fn, delay, mustRunDelay</span>)</span> &#123;</span><br><span class="line">    <span class="comment">/*eslint-disable*/</span></span><br><span class="line">    <span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> t_start</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> context = <span class="built_in">this</span>, args = <span class="built_in">arguments</span>, t_curr = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">      <span class="comment">// 清除定时操作</span></span><br><span class="line">      <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">      <span class="keyword">if</span> (!t_start) &#123;</span><br><span class="line">        t_start = t_curr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 时间间隔超过 mustRunDelay 则马上执行 fn</span></span><br><span class="line">      <span class="keyword">if</span> (t_curr - t_start &gt;= mustRunDelay) &#123;</span><br><span class="line">        fn.apply(context, args)</span><br><span class="line">        t_start = t_curr</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 定义新的定时器，一段时间后进行操作</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          fn.apply(context, args)</span><br><span class="line">        &#125;, delay)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存代理</span></span><br><span class="line"><span class="comment">// 缓存加法操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主体</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arg = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">  <span class="keyword">return</span> arg.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; a + b &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理</span></span><br><span class="line"><span class="keyword">let</span> proxyAdd = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> cache = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arg = [].slice.call(<span class="built_in">arguments</span>).join(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有，则直接从缓存返回</span></span><br><span class="line">    <span class="keyword">if</span> (cache[arg]) &#123;</span><br><span class="line">      <span class="keyword">return</span> cache[arg];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> ret = add.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">  add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line"></span><br><span class="line">  proxyAdd(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>),</span><br><span class="line">  proxyAdd(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">); <span class="comment">// 10 10 100 100</span></span><br></pre></td></tr></table></figure><h2><a href="#die-dai-qi-mo-shi" class="header-anchor">#</a><span id="die-dai-qi-mo-shi">迭代器模式</span></h2><p>迭代器模式是指提供一种方法 <code>顺序访问</code> 一个聚合对象中的各个元素，而又不需要暴露该对象的内部表示</p><p>在使用迭代器模式之后，即使不关心对象的内部构造，也可以按顺序访问其中的每个元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现 ES6 的 迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> done = i &gt;= items.length;</span><br><span class="line">      <span class="keyword">let</span> value = !done ? items[i++] : <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: done,</span><br><span class="line">        value: value,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> iterator = createIterator([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 1, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 2, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: 3, done: false &#125;&quot;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: undefined, done: true &#125;&quot;</span></span><br><span class="line"><span class="comment">// 之后的所有调用</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()); <span class="comment">// &quot;&#123; value: undefined, done: true &#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器 eg</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year2000</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &lt;= <span class="number">2000</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year2100</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &gt;= <span class="number">2100</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;C&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">year</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">if</span> (year &gt; <span class="number">2000</span> &amp;&amp; year &lt; <span class="number">2100</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iteratorYear</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; ++i) &#123;</span><br><span class="line">    <span class="keyword">let</span> ret = <span class="built_in">arguments</span>[i]();</span><br><span class="line">    <span class="keyword">if</span> (ret !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> manager = iteratorYear(year2000, year2100, year); <span class="comment">// B</span></span><br></pre></td></tr></table></figure><h2><a href="#fa-bu-ding-yue-mo-shi" class="header-anchor">#</a><span id="fa-bu-ding-yue-mo-shi">发布-订阅模式</span></h2><p>也称作观察者模式</p><h3><a href="#eg" class="header-anchor">#</a><span id="eg">eg</span></h3><p>小 A 在公司 C 完成了笔试及面试，小 B 也在公司 C 完成了笔试。他们焦急地等待结果，每隔半天就电话询问公司 C，导致公司 C 很不耐烦。</p><p>一种解决办法是 AB 直接把联系方式留给 C，有结果的话 C 自然会通知 AB</p><p>这里的询问属于显示 <code>调用</code>，留给属于 <code>订阅</code>，通知属于 <code>发布</code></p><h3><a href="#you-que-dian" class="header-anchor">#</a><span id="you-que-dian">优缺点</span></h3><h4><a href="#you" class="header-anchor">#</a><span id="you">优</span></h4><p>一为时间上的解耦，二为对象之间的解耦</p><h4><a href="#que" class="header-anchor">#</a><span id="que">缺</span></h4><ul><li><p>创建订阅者本身要消耗一定的时间和内存，订阅的处理函数不一定会被执行，驻留内存有性能开销</p></li><li><p>弱化了对象之间的联系，复杂的情况下可能会导致程序难以跟踪维护和理解</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 观察者</span></span><br><span class="line"><span class="keyword">let</span> observer = &#123;</span><br><span class="line">  <span class="comment">// 订阅集合</span></span><br><span class="line">  subscribes: [],</span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  subscribe: <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.subscribes[type]) &#123;</span><br><span class="line">      <span class="built_in">this</span>.subscribes[type] = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 收集订阅者针对订阅内容的处理函数</span></span><br><span class="line">    <span class="keyword">typeof</span> fn === <span class="string">&quot;function&quot;</span> &amp;&amp; <span class="built_in">this</span>.subscribes[type].push(fn);</span><br><span class="line">    <span class="comment">// log 为 bool, 但这种表达式有啥意义？</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布  可能会携带一些信息发布出去</span></span><br><span class="line">  publish: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> type = [].shift.call(<span class="built_in">arguments</span>),</span><br><span class="line">      fns = <span class="built_in">this</span>.subscribes[type];</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;发布  &quot;</span>, fns);</span><br><span class="line">    <span class="comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span></span><br><span class="line">    <span class="keyword">if</span> (!fns || !fns.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 挨个处理调用</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fns.length; ++i) &#123;</span><br><span class="line">      fns[i].apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除订阅</span></span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span> (<span class="params">type, fn</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 删除全部</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> type === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.subscribes = [];</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> fns = <span class="built_in">this</span>.subscribes[type];</span><br><span class="line">    <span class="comment">// 不存在的订阅类型，以及订阅时未传入处理回调的</span></span><br><span class="line">    <span class="keyword">if</span> (!fns || !fns.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      fns.length = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 挨个处理删除</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; fns.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fns[i] === fn) &#123;</span><br><span class="line">        fns.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅岗位列表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobListForA</span>(<span class="params">jobs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;A&quot;</span>, jobs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jobListForB</span>(<span class="params">jobs</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;B&quot;</span>, jobs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;job&quot;</span>, jobListForA);</span><br><span class="line"><span class="comment">// B订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;job&quot;</span>, jobListForB);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;examinationA&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(score);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// B订阅了笔试成绩</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;examinationB&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(score);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A订阅了面试结果</span></span><br><span class="line">observer.subscribe(<span class="string">&quot;interviewA&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;examinationA&quot;</span>, <span class="number">100</span>); <span class="comment">// 100</span></span><br><span class="line">observer.publish(<span class="string">&quot;examinationB&quot;</span>, <span class="number">80</span>); <span class="comment">// 80</span></span><br><span class="line">observer.publish(<span class="string">&quot;interviewA&quot;</span>, <span class="string">&quot;备用&quot;</span>); <span class="comment">// 备用</span></span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;job&quot;</span>, [<span class="string">&quot;前端&quot;</span>, <span class="string">&quot;后端&quot;</span>, <span class="string">&quot;测试&quot;</span>]); <span class="comment">// 输出A和B的岗位</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// B取消订阅了笔试成绩</span></span><br><span class="line">observer.remove(<span class="string">&quot;examinationB&quot;</span>);</span><br><span class="line"><span class="comment">// A都取消订阅了岗位</span></span><br><span class="line">observer.remove(<span class="string">&quot;job&quot;</span>, jobListForA);</span><br><span class="line"></span><br><span class="line">observer.publish(<span class="string">&quot;examinationB&quot;</span>, <span class="number">80</span>); <span class="comment">// 没有可匹配的订阅，无输出</span></span><br><span class="line">observer.publish(<span class="string">&quot;job&quot;</span>, [<span class="string">&quot;前端&quot;</span>, <span class="string">&quot;后端&quot;</span>, <span class="string">&quot;测试&quot;</span>]); <span class="comment">// 输出B的岗位</span></span><br></pre></td></tr></table></figure><h2><a href="#ming-ling-mo-shi" class="header-anchor">#</a><span id="ming-ling-mo-shi">命令模式</span></h2><h3><a href="#shi-xian" class="header-anchor">#</a><span id="shi-xian">实现</span></h3><p>简单的命令模式实现可以直接使用 <code>对象字面量</code> 的形式定义一个命令</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> incrementCommand = &#123;</span><br><span class="line">  execute: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// something</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>采用对象创建处理的方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自增</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IncrementCommand</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 当前值</span></span><br><span class="line">  <span class="built_in">this</span>.val = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 命令栈</span></span><br><span class="line">  <span class="built_in">this</span>.stack = [];</span><br><span class="line">  <span class="comment">// 栈指针位置</span></span><br><span class="line">  <span class="built_in">this</span>.stackPosition = -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IncrementCommand.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">IncrementCommand</span>,</span><br><span class="line"></span><br><span class="line">  // 执行</span><br><span class="line">  <span class="title">execute</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._clearRedo();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义执行的处理</span></span><br><span class="line">    <span class="keyword">let</span> command = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.val += <span class="number">2</span>;</span><br><span class="line">    &#125;.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行并缓存起来</span></span><br><span class="line">    command();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stack.push(command);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stackPosition++;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  canUndo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &gt;= <span class="number">0</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  canRedo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.stackPosition &lt; <span class="built_in">this</span>.stack.length - <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 撤销</span></span><br><span class="line">  undo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canUndo()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.stackPosition--;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 命令的撤销，与执行的处理相反</span></span><br><span class="line">    <span class="keyword">let</span> command = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.val -= <span class="number">2</span>;</span><br><span class="line">    &#125;.bind(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 撤销后不需要缓存</span></span><br><span class="line">    command();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重做</span></span><br><span class="line">  redo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.canRedo()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行栈顶的命令</span></span><br><span class="line">    <span class="built_in">this</span>.stack[++<span class="built_in">this</span>.stackPosition]();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.getValue();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在执行时，已经撤销的部分不能再重做</span></span><br><span class="line">  _clearRedo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.stack = <span class="built_in">this</span>.stack.slice(<span class="number">0</span>, <span class="built_in">this</span>.stackPosition + <span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前值</span></span><br><span class="line">  getValue: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.val);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2><a href="#zu-he-mo-shi" class="header-anchor">#</a><span id="zu-he-mo-shi">组合模式</span></h2><p>使用组合模式来实现扫描文件夹中的文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件夹 组合对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Folder</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.parent = <span class="literal">null</span>;</span><br><span class="line">  <span class="built_in">this</span>.files = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Folder.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Folder</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params">file</span>) &#123;</span><br><span class="line">    file.parent = <span class="built_in">this</span>;</span><br><span class="line">    <span class="built_in">this</span>.files.push(file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  scan: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 委托给叶对象处理</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.files.length; ++i) &#123;</span><br><span class="line">      <span class="built_in">this</span>.files[i].scan();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  remove: <span class="function"><span class="keyword">function</span> (<span class="params">file</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> file === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.files = [];</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.files.length; ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.files[i] === file) &#123;</span><br><span class="line">        <span class="built_in">this</span>.files.splice(i, <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件 叶对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">File</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.parent = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">File.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">File</span>,</span><br><span class="line"></span><br><span class="line">  <span class="title">add</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;文件里面不能添加文件&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  scan: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name = [<span class="built_in">this</span>.name];</span><br><span class="line">    <span class="keyword">let</span> parent = <span class="built_in">this</span>.parent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">      name.unshift(parent.name);</span><br><span class="line">      parent = parent.parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(name.join(<span class="string">&quot; / &quot;</span>));</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>实例化，在组合对象中插入组合或叶对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> web = <span class="keyword">new</span> Folder(<span class="string">&quot;Web&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> fe = <span class="keyword">new</span> Folder(<span class="string">&quot;前端&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> css = <span class="keyword">new</span> Folder(<span class="string">&quot;CSS&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> js = <span class="keyword">new</span> Folder(<span class="string">&quot;js&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> rd = <span class="keyword">new</span> Folder(<span class="string">&quot;后端&quot;</span>);</span><br><span class="line"></span><br><span class="line">web.add(fe).add(rd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> file1 = <span class="keyword">new</span> File(<span class="string">&quot;HTML权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file2 = <span class="keyword">new</span> File(<span class="string">&quot;CSS权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file3 = <span class="keyword">new</span> File(<span class="string">&quot;JavaScript权威指南.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file4 = <span class="keyword">new</span> File(<span class="string">&quot;MySQL基础.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file5 = <span class="keyword">new</span> File(<span class="string">&quot;Web安全.pdf&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> file6 = <span class="keyword">new</span> File(<span class="string">&quot;Linux菜鸟.pdf&quot;</span>);</span><br><span class="line"></span><br><span class="line">css.add(file2);</span><br><span class="line">fe.add(file1).add(file3).add(css).add(js);</span><br><span class="line">rd.add(file4).add(file5);</span><br><span class="line">web.add(file6);</span><br><span class="line"></span><br><span class="line">rd.remove(file4);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描</span></span><br><span class="line">web.scan();</span><br></pre></td></tr></table></figure><h2><a href="#mo-ban-fang-fa-mo-shi" class="header-anchor">#</a><span id="mo-ban-fang-fa-mo-shi">模板方法模式</span></h2><p>模板方法模式一般的实现方式为继承</p><p>以运动作为例子，运动有比较通用的一些处理，这部分可以抽离开来，在父类中实现。具体某项运动的特殊性则有自类来重写实现。</p><p>最终子类直接调用父类的模板函数来执行</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 体育运动</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sport</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Sport.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">Sport</span>,</span><br><span class="line"></span><br><span class="line">  // 模板，按顺序执行</span><br><span class="line">  <span class="title">init</span>: <span class="title">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.stretch();</span><br><span class="line">    <span class="built_in">this</span>.jog();</span><br><span class="line">    <span class="built_in">this</span>.deepBreath();</span><br><span class="line">    <span class="built_in">this</span>.start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> free = <span class="built_in">this</span>.end();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 运动后还有空的话，就拉伸一下</span></span><br><span class="line">    <span class="keyword">if</span> (free !== <span class="literal">false</span>) &#123;</span><br><span class="line">      <span class="built_in">this</span>.stretch();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拉伸</span></span><br><span class="line">  stretch: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;拉伸&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 慢跑</span></span><br><span class="line">  jog: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;慢跑&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 深呼吸</span></span><br><span class="line">  deepBreath: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;深呼吸&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始运动</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;子类必须重写此方法&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结束运动</span></span><br><span class="line">  end: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;运动结束&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 篮球</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Basketball</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Basketball.prototype = <span class="keyword">new</span> Sport();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写相关的方法</span></span><br><span class="line">Basketball.prototype.start = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;先投上几个三分&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Basketball.prototype.end = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;运动结束了，有事先走一步&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 马拉松</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Marathon</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Marathon.prototype = <span class="keyword">new</span> Sport();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> basketball = <span class="keyword">new</span> Basketball();</span><br><span class="line"><span class="keyword">let</span> marathon = <span class="keyword">new</span> Marathon();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子类调用，最终会按照父类定义的顺序执行</span></span><br><span class="line">basketball.init();</span><br><span class="line">marathon.init();</span><br></pre></td></tr></table></figure><h2><a href="#xiang-yuan-mo-shi" class="header-anchor">#</a><span id="xiang-yuan-mo-shi">享元模式</span></h2><p>享元（flyweight）模式是一种用于性能优化的模式，它的目标是尽量减少共享对象的数量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 健康测量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Fitness</span>(<span class="params">sex</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂，创建可共享的对象</span></span><br><span class="line"><span class="keyword">let</span> FitnessFactory = &#123;</span><br><span class="line">  objs: [],</span><br><span class="line"></span><br><span class="line">  create: <span class="function"><span class="keyword">function</span> (<span class="params">sex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.objs[sex]) &#123;</span><br><span class="line">      <span class="built_in">this</span>.objs[sex] = <span class="keyword">new</span> Fitness(sex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.objs[sex];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理器，管理非共享的部分</span></span><br><span class="line"><span class="keyword">let</span> FitnessManager = &#123;</span><br><span class="line">  fitnessData: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加一项</span></span><br><span class="line">  add: <span class="function"><span class="keyword">function</span> (<span class="params">name, sex, age, height, weight</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fitness = FitnessFactory.create(sex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存储变化的数据</span></span><br><span class="line">    <span class="built_in">this</span>.fitnessData[name] = &#123;</span><br><span class="line">      age: age,</span><br><span class="line">      height: height,</span><br><span class="line">      weight: weight,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fitness;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从存储的数据中获取，更新至当前正在使用的对象</span></span><br><span class="line">  updateFitnessData: <span class="function"><span class="keyword">function</span> (<span class="params">name, obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> fitnessData = <span class="built_in">this</span>.fitnessData[name];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> fitnessData) &#123;</span><br><span class="line">      <span class="keyword">if</span> (fitnessData.hasOwnProperty(item)) &#123;</span><br><span class="line">        obj[item] = fitnessData[item];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始评判</span></span><br><span class="line">Fitness.prototype.judge = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 操作前先更新当前状态（从外部状态管理器中获取）</span></span><br><span class="line">  FitnessManager.updateFitnessData(name, <span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ret = name + <span class="string">&quot;: &quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.sex === <span class="string">&quot;male&quot;</span>) &#123;</span><br><span class="line">    ret += <span class="built_in">this</span>.judgeMale();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ret += <span class="built_in">this</span>.judgeFemale();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(ret);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 男性评判规则</span></span><br><span class="line">Fitness.prototype.judgeMale = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="built_in">this</span>.height / <span class="built_in">this</span>.weight;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.age &gt; <span class="number">20</span> ? ratio &gt; <span class="number">3.5</span> : ratio &gt; <span class="number">2.8</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 女性评判规则</span></span><br><span class="line">Fitness.prototype.judgeFemale = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ratio = <span class="built_in">this</span>.height / <span class="built_in">this</span>.weight;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">this</span>.age &gt; <span class="number">20</span> ? ratio &gt; <span class="number">4</span> : ratio &gt; <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = FitnessManager.add(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">18</span>, <span class="number">160</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">let</span> b = FitnessManager.add(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">21</span>, <span class="number">180</span>, <span class="number">70</span>);</span><br><span class="line"><span class="keyword">let</span> c = FitnessManager.add(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">28</span>, <span class="number">160</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">let</span> d = FitnessManager.add(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">18</span>, <span class="number">170</span>, <span class="number">60</span>);</span><br><span class="line"><span class="keyword">let</span> e = FitnessManager.add(<span class="string">&quot;E&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">18</span>, <span class="number">160</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始评判</span></span><br><span class="line">a.judge(<span class="string">&quot;A&quot;</span>); <span class="comment">// A: false</span></span><br><span class="line">b.judge(<span class="string">&quot;B&quot;</span>); <span class="comment">// B: false</span></span><br><span class="line">c.judge(<span class="string">&quot;C&quot;</span>); <span class="comment">// C: false</span></span><br><span class="line">d.judge(<span class="string">&quot;D&quot;</span>); <span class="comment">// D: true</span></span><br><span class="line">e.judge(<span class="string">&quot;E&quot;</span>); <span class="comment">// E: true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// factory对象有点像单例模式，只是多了一个sex的参数，如果没有内部状态，则没有参数的factory对象就更接近单例模式了</span></span><br></pre></td></tr></table></figure><h2><a href="#zhi-ze-lian-mo-shi" class="header-anchor">#</a><span id="zhi-ze-lian-mo-shi">职责链模式</span></h2><h3><a href="#ding-yi" class="header-anchor">#</a><span id="ding-yi">定义</span></h3><p>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系，将这些对象连成一条链，并沿着这条链 传递该请求，直到有一个对象处理</p><p>它为止</p><h3><a href="#he-xin" class="header-anchor">#</a><span id="he-xin">核心</span></h3><p>请求发送者只需要知道链中的第一个节点，弱化发送者和一组接收者之间的强联系，可以便捷地在职责链中增加或删除一个节点，同样地，指定谁是第一个节</p><p>点也很便捷</p><h3><a href="#shi-xian" class="header-anchor">#</a><span id="shi-xian">实现</span></h3><p>展示不同类型的变量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义链的某一项</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ChainItem</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.fn = fn;</span><br><span class="line">  <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ChainItem.prototype = &#123;</span><br><span class="line">  <span class="title">constructor</span>: <span class="title">ChainItem</span>,</span><br><span class="line"></span><br><span class="line">  // 设置下一项</span><br><span class="line">  <span class="title">setNext</span>: <span class="title">function</span> (<span class="params">next</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.next = next;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;next:  &quot;</span> + next);</span><br><span class="line">    <span class="keyword">return</span> next;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始执行</span></span><br><span class="line">  start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 转到链的下一项执行</span></span><br><span class="line">  toNext: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.next) &#123;</span><br><span class="line">      <span class="built_in">this</span>.start.apply(<span class="built_in">this</span>.next, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;无匹配的执行项目&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示数字</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showNumber</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> num === <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;number&quot;</span>, num);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 转移到下一项</span></span><br><span class="line">    <span class="built_in">this</span>.toNext(num);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;数字后下一步&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showString</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;string&quot;</span>, str);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(str);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展示对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;object&quot;</span>, obj);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> chainNumber = <span class="keyword">new</span> ChainItem(showNumber);</span><br><span class="line"><span class="keyword">let</span> chainString = <span class="keyword">new</span> ChainItem(showString);</span><br><span class="line"><span class="keyword">let</span> chainObject = <span class="keyword">new</span> ChainItem(showObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置链条</span></span><br><span class="line"><span class="keyword">let</span> next1 = chainObject.setNext(chainNumber);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;next1:  &quot;</span> + <span class="built_in">JSON</span>.stringify(next1)); <span class="comment">// next1:  &#123;&quot;next&quot;:&#123;&quot;next&quot;:null&#125;&#125;</span></span><br><span class="line"><span class="keyword">let</span> next2 = next1.setNext(chainString);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;next2:  &quot;</span> + <span class="built_in">JSON</span>.stringify(next2)); <span class="comment">// &#123;&quot;next&quot;:null&#125;</span></span><br><span class="line"></span><br><span class="line">chainString.start(<span class="string">&quot;12&quot;</span>); <span class="comment">// string 12</span></span><br><span class="line">chainNumber.start(&#123;&#125;); <span class="comment">// 无匹配的执行项目</span></span><br><span class="line">chainObject.start(&#123;&#125;); <span class="comment">// object &#123;&#125;</span></span><br><span class="line">chainObject.start(<span class="number">123</span>); <span class="comment">// number 123</span></span><br></pre></td></tr></table></figure><p>这时想判断未定义的时候呢，直接加到链中即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展示未定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showUndefined</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj === <span class="string">&quot;undefined&quot;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;undefined&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.toNext(obj);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> chainUndefined = <span class="keyword">new</span> ChainItem(showUndefined);</span><br><span class="line">chainString.setNext(chainUndefined);</span><br><span class="line"></span><br><span class="line">chainNumber.start(); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p><code>对象增多，结构更清晰，一定程度上可能影响性能，注意避免过长的职责链</code></p><h2><a href="#zhong-jie-zhe-mo-shi" class="header-anchor">#</a><span id="zhong-jie-zhe-mo-shi">中介者模式</span></h2><h3><a href="#ding-yi" class="header-anchor">#</a><span id="ding-yi">定义</span></h3><p>所有的相关 对象都通过中介者对象来通信，而不是互相引用，所以当一个对象发生改变时，只需要通知中介者对象即可</p><h3><a href="#he-xin" class="header-anchor">#</a><span id="he-xin">核心</span></h3><p>使网状的多对多关系变成了相对简单的一对多关系（复杂的调度处理都交给中介者）</p><h3><a href="#shi-xian" class="header-anchor">#</a><span id="shi-xian">实现</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = &#123;</span><br><span class="line">  score: <span class="number">10</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自己获取</span></span><br><span class="line">    <span class="built_in">this</span>.getRank();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 直接获取</span></span><br><span class="line">  getRank: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> scores = [<span class="built_in">this</span>.score, B.score, C.score].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a &lt; b;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(scores.indexOf(<span class="built_in">this</span>.score) + <span class="number">1</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> B = &#123;</span><br><span class="line">  score: <span class="number">20</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过中介者获取</span></span><br><span class="line">    rankMediator(B);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> C = &#123;</span><br><span class="line">  score: <span class="number">30</span>,</span><br><span class="line"></span><br><span class="line">  changeTo: <span class="function"><span class="keyword">function</span> (<span class="params">score</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.score = score;</span><br><span class="line"></span><br><span class="line">    rankMediator(C);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者，计算排名</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rankMediator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> scores = [A.score, B.score, C.score].sort(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(scores.indexOf(person.score) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A通过自身来处理</span></span><br><span class="line">A.changeTo(<span class="number">100</span>); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// B和C交由中介者处理</span></span><br><span class="line">B.changeTo(<span class="number">200</span>); <span class="comment">// 1</span></span><br><span class="line">C.changeTo(<span class="number">50</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>虽然中介者做到了对模块和对象的解耦，但有时对象之间的关系并非一定要解耦，强行使用中介者来整合，可能会使代码更为繁琐，需要注意</p><h2><a href="#zhuang-shi-zhe-mo-shi" class="header-anchor">#</a><span id="zhuang-shi-zhe-mo-shi">装饰者模式</span></h2><h3><a href="#1-ding-yi" class="header-anchor">#</a><span id="1-ding-yi">1. 定义</span></h3><p>以动态地给某个对象添加一些额外的职责，而不会影响从这个类中派生的其他对象。<br>是一种“即用即付”的方式，能够在不改变对 象自身的基础上，在程序运行期间给对象动态地 添加职责</p><h3><a href="#2-he-xin" class="header-anchor">#</a><span id="2-he-xin">2. 核心</span></h3><p>是为对象动态加入行为，经过多重包装，可以形成一条装饰链</p><h3><a href="#3-shi-xian" class="header-anchor">#</a><span id="3-shi-xian">3. 实现</span></h3><p>最简单的装饰者，就是重写对象的属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = &#123;</span><br><span class="line">  score: <span class="number">10</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A.score = <span class="string">&quot;分数：&quot;</span> + A.score;</span><br></pre></td></tr></table></figure><p>可以使用传统面向对象的方法来实现装饰，添加技能</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">Person.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;数学&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器，还会音乐</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MusicDecorator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MusicDecorator.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person.skill();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器，还会跑步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RunDecorator</span>(<span class="params">person</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RunDecorator.prototype.skill = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.person.skill();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰一下</span></span><br><span class="line"><span class="keyword">let</span> person1 = <span class="keyword">new</span> MusicDecorator(person);</span><br><span class="line">person1 = <span class="keyword">new</span> RunDecorator(person1);</span><br><span class="line"></span><br><span class="line">person.skill(); <span class="comment">// 数学</span></span><br><span class="line">person1.skill(); <span class="comment">// 数学 音乐 跑步</span></span><br></pre></td></tr></table></figure><p><code>更简洁的写法</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装饰器，在当前函数执行前先执行另一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decoratorBefore</span>(<span class="params">fn, beforeFn</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> ret = beforeFn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在前一个函数中判断，不需要执行当前函数</span></span><br><span class="line">    <span class="keyword">if</span> (ret !== <span class="literal">false</span>) &#123;</span><br><span class="line">      fn.apply(<span class="built_in">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skill</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;数学&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skillMusic</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;音乐&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skillRun</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;跑步&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> skillDecorator = decoratorBefore(skill, skillMusic);</span><br><span class="line">skillDecorator = decoratorBefore(skillDecorator, skillRun);</span><br><span class="line"></span><br><span class="line">skillDecorator(); <span class="comment">// 跑步 音乐 数学</span></span><br></pre></td></tr></table></figure><h2><a href="#zhuang-tai-mo-shi" class="header-anchor">#</a><span id="zhuang-tai-mo-shi">状态模式</span></h2><h3><a href="#1-ding-yi" class="header-anchor">#</a><span id="1-ding-yi">1. 定义</span></h3><p>事物内部状态的改变往往会带来事物的行为改变。在处理的时候，将这个处理委托给当前的 <code>状态对象</code> 即可，该状态对象会负责渲染它自身的行为</p><h3><a href="#2-he-xin" class="header-anchor">#</a><span id="2-he-xin">2. 核心</span></h3><p>区分事物内部的状态，把事物的每种状态都封装成单独的类，跟此种状态有关的行为都被封装在这个类的内部</p><h3><a href="#3-shi-xian" class="header-anchor">#</a><span id="3-shi-xian">3. 实现</span></h3><p>以一个人的工作状态作为例子，在刚醒、精神、疲倦几个状态中切换着</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 工作状态</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Work</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name;</span><br><span class="line">  <span class="built_in">this</span>.currentState = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 工作状态，保存为对应状态对象</span></span><br><span class="line">  <span class="built_in">this</span>.wakeUpState = <span class="keyword">new</span> WakeUpState(<span class="built_in">this</span>);</span><br><span class="line">  <span class="comment">// 精神饱满</span></span><br><span class="line">  <span class="built_in">this</span>.energeticState = <span class="keyword">new</span> EnergeticState(<span class="built_in">this</span>);</span><br><span class="line">  <span class="comment">// 疲倦</span></span><br><span class="line">  <span class="built_in">this</span>.tiredState = <span class="keyword">new</span> TiredState(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Work.prototype.init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.currentState = <span class="built_in">this</span>.wakeUpState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 点击事件，用于触发更新状态</span></span><br><span class="line">  <span class="built_in">document</span>.body.onclick = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentState.behaviour();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新工作状态</span></span><br><span class="line">Work.prototype.setState = <span class="function"><span class="keyword">function</span> (<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.currentState = state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刚醒</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WakeUpState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 刚醒的行为</span></span><br><span class="line">WakeUpState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;刚醒呢，睡个懒觉先&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 只睡了2秒钟懒觉就精神了..</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.energeticState);</span><br><span class="line">  &#125;, <span class="number">2</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 精神饱满</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">EnergeticState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EnergeticState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;超级精神的&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 才精神1秒钟就发困了</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.tiredState);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 疲倦</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TiredState</span>(<span class="params">work</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.work = work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TiredState.prototype.behaviour = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.work.name, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;怎么肥事，好困&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不知不觉，又变成了刚醒着的状态... 不断循环呀</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.work.setState(<span class="built_in">this</span>.work.wakeUpState);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> work = <span class="keyword">new</span> Work(<span class="string">&quot;曹操&quot;</span>);</span><br></pre></td></tr></table></figure><h3><a href="#4-you-que-dian" class="header-anchor">#</a><span id="4-you-que-dian">4. 优缺点</span></h3><h4><a href="#you-dian" class="header-anchor">#</a><span id="you-dian">优点</span></h4><p>状态切换逻辑分布在状态类中，易于维护</p><h4><a href="#que-dian" class="header-anchor">#</a><span id="que-dian">缺点</span></h4><p>多个状态类，影响性能，可用享元模式进一步优化</p><p>将逻辑分散在状态类中，不易看出状态机变化逻辑</p><h2><a href="#shi-si-gua-pei-qi-mo-shi" class="header-anchor">#</a><span id="shi-si-gua-pei-qi-mo-shi">十四、适配器模式</span></h2><h3><a href="#ding-yi" class="header-anchor">#</a><span id="ding-yi">定义</span></h3><p>是解决两个软件实体间的接口不兼容的问题，对不兼容的部分进行适配</p><h3><a href="#shi-xian" class="header-anchor">#</a><span id="shi-xian">实现</span></h3><p>比如一个简单的数据格式转换的适配器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染数据，格式限制为数组了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  data.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对非数组的进行转换适配</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">arrayAdapter</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.toString.call(data) === <span class="string">&quot;[object Array]&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> temp = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">in</span> data) &#123;</span><br><span class="line">    <span class="comment">// hasOwnProperty() 方法会返回一个布尔值，指示对象自身属性中是否具有指定的属性（也就是，是否有指定的键）</span></span><br><span class="line">    <span class="comment">// 原型链上继承过来的属性无法通过 hasOwnProperty 检测到</span></span><br><span class="line">    <span class="keyword">if</span> (data.hasOwnProperty(item)) &#123;</span><br><span class="line">      temp.push(data[item]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">  <span class="number">0</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">renderData(arrayAdapter(data)); <span class="comment">// A B C</span></span><br></pre></td></tr></table></figure><h2><a href="#wai-guan-mo-shi" class="header-anchor">#</a><span id="wai-guan-mo-shi">外观模式</span></h2><h3><a href="#1-ding-yi" class="header-anchor">#</a><span id="1-ding-yi">1. 定义</span></h3><p>为子系统中的<code>一组接口</code>提供一个<code>一致的界面</code>，定义一个<code>高层接口</code>，这个接口使子系统更加容易使用</p><h3><a href="#2-he-xin" class="header-anchor">#</a><span id="2-he-xin">2. 核心</span></h3><p>可以通过请求外观接口来达到访问子系统，也可以选择越过外观来直接访问子系统</p><h3><a href="#3-shi-xian" class="header-anchor">#</a><span id="3-shi-xian">3. 实现</span></h3><p>外观模式在 JS 中，可以认为是一组函数的集合</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 三个处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doing</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;doing&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观函数，将一些处理统一起来，方便调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  start();</span><br><span class="line">  doing();</span><br><span class="line">  end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用init开始执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 此处直接调用了高层函数，也可以选择越过它直接调用相关的函数</span></span><br><span class="line">  execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">init(); <span class="comment">// start doing end</span></span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://example.com/2021/09/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="cku5jkixn003i7h0cb9532wjp" class="article-share-link">Share</a> <a href="http://example.com/2021/09/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul></footer></div></article><article id="post-应用架构模式" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/" class="article-date"><time datetime="2021-09-23T04:53:32.000Z" itemprop="datePublished">2021-09-23</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/">应用架构模式</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#jia-gou-shi-dui-ke-guan-de-tuo-xie">架构是对客观的妥协</a></li><li><a href="#qian-hou-bu-fen-chi-mvc">前后不分离-MVC</a><ul><li><a href="#modal">modal</a></li><li><a href="#view">view</a></li><li><a href="#controller">controller</a></li></ul></li><li><a href="#qian-hou-fen-chi">前后分离</a></li><li><a href="#can-kao">参考</a></li></ul></div><h1><a href="#jia-gou-shi-dui-ke-guan-de-tuo-xie" class="header-anchor">#</a><span id="jia-gou-shi-dui-ke-guan-de-tuo-xie">架构是对客观的妥协</span></h1><ul><li>应用要处理的事务太多，一个人开发不过来，需要分离 view 和 model，一个来处理 view (这个人成了前端)，一个来处理 model (这个成了后端)</li><li>一台服务器撑不起 model 和 data 的操作，那么就分布式吧 balabala</li><li>…</li></ul><h1><a href="#qian-hou-bu-fen-chi-mvc" class="header-anchor">#</a><span id="qian-hou-bu-fen-chi-mvc">前后不分离-MVC</span></h1><p>MVC 的本质就是分离界面和逻辑</p><h2><a href="#modal" class="header-anchor">#</a><span id="modal">modal</span></h2><ul><li>应用逻辑层的对象，我理解为业务对象。如 Account、Order，包含业务逻辑方法、操作，如 Account.sendEmail()、Order.calculateTotal()</li><li>介于数据库和 controller 之间，可通过 SQL(结构化查询语言) 与数据库进行交互</li></ul><h2><a href="#view" class="header-anchor">#</a><span id="view">view</span></h2><p>视图，modal 的数据的展示</p><h2><a href="#controller" class="header-anchor">#</a><span id="controller">controller</span></h2><ul><li>也叫 View Controller，视图控制器，注意与整个应用的集中控制器 Application Controller 区分开</li><li>控制数据流向 modal，并在数据变化时更新 view，“用户发了个 xx 请求，带了参数 {a:xxx}，哪个 B model，找你的，参数也给你，你处理好了把数据还给我，我还给 view”</li><li>controller 层越薄越好，业务逻辑尽量放到对应的 model 下而不是放 controller 处</li></ul><img src="/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/mvc.jpg" class width="800" height="600"><p>上图中的 model (甭管它是 Java Bean 还是其他的名称)，也可以直接将 model 数据回传给 view，不一定需要 controller 经手</p><h1><a href="#qian-hou-fen-chi" class="header-anchor">#</a><span id="qian-hou-fen-chi">前后分离</span></h1><p>mvp mvvm 等<br>前后不分离：后端渲染生成 html，ajax 诞生前都是这样</p><h1><a href="#can-kao" class="header-anchor">#</a><span id="can-kao">参考</span></h1><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/22886622/answer/48378638">https://www.zhihu.com/question/22886622/answer/48378638</a><br><a target="_blank" rel="noopener" href="https://www.runoob.com/design-pattern/mvc-pattern.html">https://www.runoob.com/design-pattern/mvc-pattern.html</a><br><a target="_blank" rel="noopener" href="https://growth.phodal.com/#mvc">https://growth.phodal.com/#mvc</a></p></div><footer class="article-footer"><a data-url="http://example.com/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/" data-id="cku5jkiwa001d7h0c4aw080vs" class="article-share-link">Share</a> <a href="http://example.com/2021/09/23/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84/" rel="tag">应用架构</a></li></ul></footer></div></article><article id="post-后端应用相关" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/17/%E5%90%8E%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9B%B8%E5%85%B3/" class="article-date"><time datetime="2021-09-17T07:55:30.000Z" itemprop="datePublished">2021-09-17</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/17/%E5%90%8E%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9B%B8%E5%85%B3/">后端应用相关</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#node-js-web-kuang-jia">node.js web 框架</a></li><li><a href="#node-js-zhi-chi-bu-fen-es6-yu-fa">node.js 支持部分 es6 语法</a></li></ul></div><h1><a href="#node-js-web-kuang-jia" class="header-anchor">#</a><span id="node-js-web-kuang-jia">node.js web 框架</span></h1><p>koa.js,egg.js,express.js 三者有什么区别？ <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/391604647/answer/1327741879">https://www.zhihu.com/question/391604647/answer/1327741879</a></p><h1><a href="#node-js-zhi-chi-bu-fen-es6-yu-fa" class="header-anchor">#</a><span id="node-js-zhi-chi-bu-fen-es6-yu-fa">node.js 支持部分 es6 语法</span></h1><p>安装 es-checker 可查看支持程度</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">lanying@lanyingdeMacBook-Pro _not-business % yarn global add es-checker</span><br><span class="line">yarn global v1.22.11</span><br><span class="line">[1/4] 🔍  Resolving packages...</span><br><span class="line">[2/4] 🚚  Fetching packages...</span><br><span class="line">[3/4] 🔗  Linking dependencies...</span><br><span class="line">warning <span class="string">&quot; &gt; ts-node@10.2.1&quot;</span> has unmet peer dependency <span class="string">&quot;@types/node@*&quot;</span>.</span><br><span class="line">[4/4] 🔨  Building fresh packages...</span><br><span class="line"></span><br><span class="line">success Installed <span class="string">&quot;es-checker@1.4.2&quot;</span> with binaries:</span><br><span class="line">      - es-checker</span><br><span class="line">✨  Done <span class="keyword">in</span> 2.37s.</span><br><span class="line">lanying@lanyingdeMacBook-Pro _not-business % es-checker</span><br><span class="line"></span><br><span class="line">ECMAScript 6 Feature Detection (v1.4.2)</span><br><span class="line"></span><br><span class="line">Variables</span><br><span class="line">  √ <span class="built_in">let</span> and const</span><br><span class="line">  √ TDZ error <span class="keyword">for</span> too-early access of <span class="built_in">let</span> or const declarations</span><br><span class="line">  √ Redefinition of const declarations not allowed</span><br><span class="line">  √ destructuring assignments/declarations <span class="keyword">for</span> arrays and objects</span><br><span class="line">  √ ... operator</span><br><span class="line"></span><br><span class="line">Data Types</span><br><span class="line">  √ For...of loop</span><br><span class="line">  √ Map, Set, WeakMap, WeakSet</span><br><span class="line">  √ Symbol</span><br><span class="line">  √ Symbols cannot be implicitly coerced</span><br><span class="line"></span><br><span class="line"><span class="comment"># ......(后续不列举了)</span></span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://example.com/2021/09/17/%E5%90%8E%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9B%B8%E5%85%B3/" data-id="cku5jkiw5001a7h0c5x6xbqas" class="article-share-link">Share</a> <a href="http://example.com/2021/09/17/%E5%90%8E%E7%AB%AF%E5%BA%94%E7%94%A8%E7%9B%B8%E5%85%B3/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF%E7%9B%B8%E5%85%B3/" rel="tag">后端相关</a></li></ul></footer></div></article><article id="post-个人建站相关" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/17/%E4%B8%AA%E4%BA%BA%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/" class="article-date"><time datetime="2021-09-17T03:01:55.000Z" itemprop="datePublished">2021-09-17</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/17/%E4%B8%AA%E4%BA%BA%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/">个人建站相关</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#ssh-yuan-cheng-lian-jie-fu-wu-qi">ssh 远程连接服务器</a></li><li><a href="#shang-chuan-yuan-ma-wen-jian-dao-fu-wu-qi">上传源码/文件到服务器</a><ul><li><a href="#zhi-jie-shang-chuan-dao-fu-wu-qi">直接上传到服务器</a></li><li><a href="#zai-fu-wu-qi-shang-da-jian-yi-ge-git-scp-fu-wu-jin-xing-tong-bu">在服务器上搭建一个 git/scp 服务进行同步</a><ul><li><a href="#da-jian-git-si-fu">搭建 git 私服</a></li></ul></li></ul></li><li><a href="#chi-xu-yun-xing-fu-wu-node-js-huan-jing">持续运行服务(node.js 环境)</a></li><li><a href="#fang-huo-qiang">防火墙</a></li><li><a href="#docker-xiang-guan">docker 相关</a><ul><li><a href="#ji-ben-gai-nian">基本概念</a></li><li><a href="#chuang-jian-docker-huan-jing">创建 docker 环境</a></li><li><a href="#ru-he-shi-yong-docker-bu-shu-ying-yong">如何使用 docker 部署应用</a><ul><li><a href="#rong-qi-guan-li-gong-ju-tui-jian">容器管理工具(推荐)</a></li><li><a href="#ding-zhi-jing-xiang">定制镜像</a></li><li><a href="#gou-jian-jing-xiang-bing-qi-dong-rong-qi">构建镜像并启动容器</a></li><li><a href="#jing-xiang-cao-zuo">镜像操作</a></li><li><a href="#rong-qi-cao-zuo">容器操作</a></li></ul></li><li><a href="#jie-he-a-li-yun-fei-liu-yi-jian-bu-shu">结合阿里云飞流一键部署</a></li></ul></li></ul></div><h1><a href="#ssh-yuan-cheng-lian-jie-fu-wu-qi" class="header-anchor">#</a><span id="ssh-yuan-cheng-lian-jie-fu-wu-qi">ssh 远程连接服务器</span></h1><p>使用 item-2，通过密钥连接，操作如下</p><p>1.在阿里云上生成密钥并重启服务器</p><p>2.<code>cd ~/.ssh</code>, 在该目录下新建 config 文件（无后缀名）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># host_name</span><br><span class="line">Host aliyun-lite</span><br><span class="line">    HostName xxx.xxx</span><br><span class="line">    User root</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    # 密钥文件路径</span><br><span class="line">    IdentityFile &#123;src_to_identity_file&#125;</span><br></pre></td></tr></table></figure><p>3.连接指定 host<br><code>ssh aliyun-lite</code> 即 <code>ssh &#123;host_name&#125;</code></p><h1><a href="#shang-chuan-yuan-ma-wen-jian-dao-fu-wu-qi" class="header-anchor">#</a><span id="shang-chuan-yuan-ma-wen-jian-dao-fu-wu-qi">上传源码/文件到服务器</span></h1><h2><a href="#zhi-jie-shang-chuan-dao-fu-wu-qi" class="header-anchor">#</a><span id="zhi-jie-shang-chuan-dao-fu-wu-qi">直接上传到服务器</span></h2><p>ftp（文件传输协议）方式，ftp 允许用户以文件操作的方式（如文件的增、删、改、查、传送等）与另一主机相互通信</p><p>五个最佳 FTP 客户端工具： <a target="_blank" rel="noopener" href="https://blog.csdn.net/yissan/article/details/51675651">https://blog.csdn.net/yissan/article/details/51675651</a></p><h2><a href="#zai-fu-wu-qi-shang-da-jian-yi-ge-git-scp-fu-wu-jin-xing-tong-bu" class="header-anchor">#</a><span id="zai-fu-wu-qi-shang-da-jian-yi-ge-git-scp-fu-wu-jin-xing-tong-bu">在服务器上搭建一个 git/scp 服务进行同步</span></h2><h3><a href="#da-jian-git-si-fu" class="header-anchor">#</a><span id="da-jian-git-si-fu">搭建 git 私服</span></h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013999832">https://segmentfault.com/a/1190000013999832</a></p><h1><a href="#chi-xu-yun-xing-fu-wu-node-js-huan-jing" class="header-anchor">#</a><span id="chi-xu-yun-xing-fu-wu-node-js-huan-jing">持续运行服务(node.js 环境)</span></h1><p>安装 pm2 依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pm2 start example.js  &#x2F;&#x2F;启动服务</span><br><span class="line">pm2 list &#x2F;&#x2F;查看启动的应用</span><br><span class="line">pm2 show example.js &#x2F;&#x2F;查看详细信息</span><br><span class="line">pm2 logs &#x2F;&#x2F;查看当前信息</span><br><span class="line">pm2 stop example.js &#x2F;&#x2F;停止example</span><br><span class="line">pm2 delete example.js &#x2F;&#x2F;删除example</span><br></pre></td></tr></table></figure><h1><a href="#fang-huo-qiang" class="header-anchor">#</a><span id="fang-huo-qiang">防火墙</span></h1><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 状态</span></span><br><span class="line">firewall-cmd --state</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># 开启</span></span><br><span class="line">systemctl start firewalld</span><br></pre></td></tr></table></figure><h1><a href="#docker-xiang-guan" class="header-anchor">#</a><span id="docker-xiang-guan">docker 相关</span></h1><h2><a href="#ji-ben-gai-nian" class="header-anchor">#</a><span id="ji-ben-gai-nian">基本概念</span></h2><ul><li>镜像<br>操作系统分内核和用户空间<br>对于 Linux 而言，内核启动后，会挂载<code>root 文件系统</code>为其提供用户空间支持, Docker 镜像是一个特殊的 root 文件系统，挂载后能提供一些额外功能<br>docker 镜像是分层存储的架构，即由一组文件系统组成</li><li>容器<br>镜像=类，容器=实例，容器也是分层的<br>容器写数据到<code>数据卷</code>，读取<code>容器存储层</code>或<code>数据卷</code>的数据，具体数据流后续再详谈。 容器消亡时，容器存储层消亡，<code>数据卷</code>不会消亡</li><li>仓库<br>一个 Docker Registry 中可以包含多个仓库（Repository），每个仓库可以包含多个标签（Tag），每个标签对应一个镜像，通常，一个仓库会包含同一个软件不同版本的镜像</li></ul><h2><a href="#chuang-jian-docker-huan-jing" class="header-anchor">#</a><span id="chuang-jian-docker-huan-jing">创建 docker 环境</span></h2><p>阿里云购买服务器时可选择 docker 镜像并一键部署</p><h2><a href="#ru-he-shi-yong-docker-bu-shu-ying-yong" class="header-anchor">#</a><span id="ru-he-shi-yong-docker-bu-shu-ying-yong">如何使用 docker 部署应用</span></h2><ul><li>定制镜像</li><li>构建镜像</li><li>启动容器</li></ul><h3><a href="#rong-qi-guan-li-gong-ju-tui-jian" class="header-anchor">#</a><span id="rong-qi-guan-li-gong-ju-tui-jian">容器管理工具(推荐)</span></h3><p>portainer.io<br><a target="_blank" rel="noopener" href="https://documentation.portainer.io/v2.0/deploy/ceinstalldocker/">https://documentation.portainer.io/v2.0/deploy/ceinstalldocker/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ExMan/p/11657069.html">https://www.cnblogs.com/ExMan/p/11657069.html</a></p><h3><a href="#ding-zhi-jing-xiang" class="header-anchor">#</a><span id="ding-zhi-jing-xiang">定制镜像</span></h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> NODE_ENV=production</span><br><span class="line"><span class="keyword">ENV</span> NODE_VERSION <span class="number">14.17</span>.<span class="number">3</span></span><br><span class="line"><span class="keyword">ENV</span> YARN_VERSION <span class="number">1.22</span>.<span class="number">11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> WORK_DIR=/usr/app/blog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行命令，创建文件夹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p <span class="variable">$&#123;WORK_DIR&#125;</span></span></span><br><span class="line"><span class="comment"># 修改文件夹权限</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod -R 777 <span class="variable">$&#123;WORK_DIR&#125;</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p <span class="variable">$&#123;WORK_DIR&#125;</span>/logs</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod -R 777 <span class="variable">$&#123;WORK_DIR&#125;</span>/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set working directory</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$&#123;WORK_DIR&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> node --version &amp;&amp; npm --version &amp;&amp; yarn --version</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">&quot;package.json&quot;</span>, <span class="string">&quot;package-lock.json*&quot;</span>, <span class="string">&quot;./&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install PM2 globally</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yarn global add pm2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yarn</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 校正时间</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy all files</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./ ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 容器端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有文件和文件夹，包括隐藏目录</span></span><br><span class="line"><span class="comment"># cntofu.com/book/139/index.html</span></span><br><span class="line"><span class="comment"># https://zhuanlan.zhihu.com/p/57390458</span></span><br><span class="line"><span class="comment"># 等同 RUN ls -a -l -R -I &quot;node_modules*&quot;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ls -alR -I <span class="string">&quot;node_modules*&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;pm2-runtime&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;--raw&quot;</span>, <span class="string">&quot;app.js&quot;</span>, <span class="string">&quot;--env&quot;</span>, <span class="string">&quot;production&quot;</span>]</span></span><br></pre></td></tr></table></figure><h3><a href="#gou-jian-jing-xiang-bing-qi-dong-rong-qi" class="header-anchor">#</a><span id="gou-jian-jing-xiang-bing-qi-dong-rong-qi">构建镜像并启动容器</span></h3><p>cd 至项目在主机上的目录，执行 build.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./build.sh <span class="comment"># 提示没有权限</span></span><br><span class="line">chmod 777 ./build.sh <span class="comment"># 修改该文件的权限</span></span><br><span class="line">./build.sh <span class="comment"># 再次执行</span></span><br></pre></td></tr></table></figure><p>项目结构参考：<a target="_blank" rel="noopener" href="https://github.com/LahmYing/deploy-by-docker">https://github.com/LahmYing/deploy-by-docker</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./build.sh</span></span><br><span class="line"><span class="comment"># 只需修改版本号，即新建对应版本的镜像和容器</span></span><br><span class="line"><span class="comment"># 暂不指定端口，方便在 portainer 处理版本和端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># command result to var &#x27;tag&#x27;</span></span><br><span class="line">tag=$(date +%Y_%m_%d_%H_%M_%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">docker build -t blog:<span class="variable">$&#123;tag&#125;</span> .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line">docker run \</span><br><span class="line">    -itd \</span><br><span class="line">    --name blog_<span class="variable">$&#123;tag&#125;</span> \</span><br><span class="line">    --restart always \</span><br><span class="line">    blog:<span class="variable">$&#123;tag&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器</span></span><br><span class="line"><span class="comment"># docker exec -i -t blog /bin/bash</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3><a href="#jing-xiang-cao-zuo" class="header-anchor">#</a><span id="jing-xiang-cao-zuo">镜像操作</span></h3><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 Docker Hub 网站搜索镜像</span></span><br><span class="line">docker search &#123;image&#125;</span><br><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">docker pull &#123;image&#125;</span><br><span class="line"><span class="comment"># 本地主机上的镜像</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">docker rmi &#123;image&#125;</span><br></pre></td></tr></table></figure><h3><a href="#rong-qi-cao-zuo" class="header-anchor">#</a><span id="rong-qi-cao-zuo">容器操作</span></h3><figure class="highlight zsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于镜像新建并启动容器</span></span><br><span class="line">docker run &#123;OPTIONS&#125; &#123;image&#125;</span><br><span class="line"><span class="comment"># OPTIONS 见 https://www.runoob.com/docker/docker-run-command.html</span></span><br><span class="line"><span class="comment"># -d: 后台运行容器，并返回容器ID, --name=&quot;nginx-lb&quot;: 为容器指定一个名称</span></span><br><span class="line">docker run -d --name=<span class="string">&quot;nginx-lb&quot;</span> &#123;主机端口&#125;:&#123;容器端口&#125; &#123;image&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出运行中的容器</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 列出所有容器</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动/停止</span></span><br><span class="line">docker start/stop &#123;容器ID&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制删除容器</span></span><br><span class="line">docker rm -f &#123;容器A的ID&#125; &#123;容器B的ID&#125;</span><br></pre></td></tr></table></figure><h2><a href="#jie-he-a-li-yun-fei-liu-yi-jian-bu-shu" class="header-anchor">#</a><span id="jie-he-a-li-yun-fei-liu-yi-jian-bu-shu">结合阿里云飞流一键部署</span></h2><p>阿里云飞流 <a target="_blank" rel="noopener" href="https://flow.teambition.com/">https://flow.teambition.com/</a><br>步骤如下：</p><ul><li>代码源： 授权使用 github</li><li>node.js 构建命令： <code>yarn</code></li><li>构建镜像并推到阿里云镜像仓库<br>需要新建一个<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-shenzhen/instances">阿里云镜像仓库</a>（公开，有时要在 portainer.io 修改容器与主机端口并新建容器，portainer 只能 pull 公开的镜像）</li><li>启动容器</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $myimage 是变量，是上一步飞流构建的镜像</span></span><br><span class="line"><span class="built_in">export</span> myimage=$(<span class="built_in">echo</span> <span class="variable">$myimage</span> | base64 -d)</span><br><span class="line">tag=$(date +%Y_%m_%d_%H_%M_%S)</span><br><span class="line">docker run \</span><br><span class="line">    -itd \</span><br><span class="line">    -p 80:80  \</span><br><span class="line">    --name blog_<span class="variable">$tag</span> \</span><br><span class="line">    --restart always \</span><br><span class="line">    <span class="variable">$myimage</span></span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://example.com/2021/09/17/%E4%B8%AA%E4%BA%BA%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/" data-id="cku5jkivx00117h0c4kr8hld6" class="article-share-link">Share</a> <a href="http://example.com/2021/09/17/%E4%B8%AA%E4%BA%BA%E5%BB%BA%E7%AB%99%E7%9B%B8%E5%85%B3/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BB%BA%E7%AB%99/" rel="tag">建站</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E8%BF%90%E7%BB%B4/" rel="tag">网络运维</a></li></ul></footer></div></article><article id="post-ts" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/10/ts/" class="article-date"><time datetime="2021-09-10T06:16:19.000Z" itemprop="datePublished">2021-09-10</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/10/ts/">ts</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#zhong-duan-yun-xing-ts-wen-jian">终端运行 TS 文件</a><ul><li><a href="#wen-jian-jie-gou">文件结构</a><ul><li><a href="#test-ts">test.ts</a></li><li><a href="#tsconfig-json">tsconfig.json</a></li></ul></li></ul></li><li><a href="#lei-xing">类型</a><ul><li><a href="#hui-gu-js-shu-ju-lei-xing">回顾 js 数据类型</a></li><li><a href="#void">void</a></li><li><a href="#undefined-he-null-shi-suo-you-lei-xing-de-zi-lei-xing">undefined 和 null 是所有类型的子类型</a></li><li><a href="#any">any</a><ul><li><a href="#ying-yong-yu-vue-ts">应用于 Vue+ts</a></li></ul></li><li><a href="#lian-he-lei-xing">联合类型</a><ul><li><a href="#zhi-neng-fang-wen-gong-you-de-shu-xing-huo-fang-fa">只能访问共有的属性或方法</a></li></ul></li></ul></li><li><a href="#jie-kou">接口</a><ul><li><a href="#ke-xuan-zhi-du-ren-yi-shu-xing">可选、只读、任意属性</a></li><li><a href="#ts-ru-he-pan-duan-shi-li-shi-fou-shi-xian-liao-jie-kou">ts 如何判断实例是否实现了接口</a></li></ul></li><li><a href="#shu-zu">数组</a></li><li><a href="#lei-xing-duan-yan">类型断言</a><ul><li><a href="#duan-yan-de-xian-zhi-tiao-jian">断言的限制条件</a></li><li><a href="#jiang-zi-lei-shi-li-ke-fu-gei-fu-lei-bian-liang">将子类实例可赋给父类变量</a></li><li><a href="#fu-zhi-shi-jin-liang-bi-mian-yong-lei-xing-duan-yan">赋值时尽量避免用类型断言</a></li></ul></li><li><a href="#sheng-ming-wen-jian">声明文件</a><ul><li><a href="#guan-li-xia-zai-di-san-fang-ku-sheng-ming-wen-jian">管理、下载第三方库声明文件</a></li><li><a href="#shu-xie-fa-bu-sheng-ming-wen-jian">书写、发布声明文件</a></li></ul></li><li><a href="#nei-zhi-dui-xiang">内置对象</a><ul><li><a href="#ts-bao-han-js-dom-bom-de-nei-zhi-dui-xiang">ts 包含 js、DOM、BOM 的内置对象</a></li><li><a href="#ts-bu-bao-han-node-js-de-nei-zhi-dui-xiang">ts 不包含 Node.js 的内置对象</a></li><li><a href="#typescript-he-xin-ku-de-ding-yi-wen-jian">TypeScript 核心库的定义文件</a></li></ul></li><li><a href="#lei-xing-bie-ming">类型别名</a></li><li><a href="#zi-fu-chuan-zi-mian-liang-lei-xing">字符串字面量类型</a></li><li><a href="#yuan-zu">元组</a></li><li><a href="#mei-ju">枚举</a><ul><li><a href="#shou-dong-fu-zhi-bu-tui-jian">手动赋值（不推荐）</a></li><li><a href="#chang-shu-mei-ju-const-enum">常数枚举 const enum</a></li><li><a href="#wai-bu-mei-ju-declare-enum">外部枚举 declare enum</a></li></ul></li><li><a href="#lei">类</a><ul><li><a href="#xiang-guan-gai-nian">相关概念</a></li><li><a href="#yong-fa">用法</a><ul><li><a href="#es6">ES6</a></li></ul></li><li><a href="#fang-wen-xiu-shi-fu">访问修饰符</a><ul><li><a href="#public-private-protected">public private protected</a></li><li><a href="#readonly">readonly</a></li></ul></li><li><a href="#chou-xiang-lei">抽象类</a></li></ul></li><li><a href="#lei-yu-jie-kou">类与接口</a><ul><li><a href="#lei-shi-xian-jie-kou">类实现接口</a></li><li><a href="#jie-kou-ji-cheng-jie-kou">接口继承接口</a></li><li><a href="#jie-kou-ji-cheng-lei">接口继承类</a></li></ul></li><li><a href="#fan-xing">泛型</a><ul><li><a href="#duo-ge-lei-xing-can-shu">多个类型参数</a></li></ul></li><li><a href="#sheng-ming-he-bing">声明合并</a></li><li><a href="#kuo-zhan-yue-du">扩展阅读</a></li></ul></div><h1><a href="#zhong-duan-yun-xing-ts-wen-jian" class="header-anchor">#</a><span id="zhong-duan-yun-xing-ts-wen-jian">终端运行 TS 文件</span></h1><p><code>yarn global add typescript</code><br><code>yarn global add ts-node</code></p><h2><a href="#wen-jian-jie-gou" class="header-anchor">#</a><span id="wen-jian-jie-gou">文件结构</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run-ts</span><br><span class="line">- test.ts</span><br><span class="line">- tsconfig.json</span><br></pre></td></tr></table></figure><h3><a href="#test-ts" class="header-anchor">#</a><span id="test-ts">test.ts</span></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anyThing: <span class="built_in">any</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;anyThing.myName: &quot;</span>, anyThing.myName); <span class="comment">// console 需 dom lib, 见 tsconfig.json</span></span><br></pre></td></tr></table></figure><h3><a href="#tsconfig-json" class="header-anchor">#</a><span id="tsconfig-json">tsconfig.json</span></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;lib&quot;</span>: [<span class="string">&quot;esnext&quot;</span>, <span class="string">&quot;dom&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;module&quot;</span>: <span class="string">&quot;esnext&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span>: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;pretty&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;esnext&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [<span class="string">&quot;./*.ts&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><a href="#lei-xing" class="header-anchor">#</a><span id="lei-xing">类型</span></h1><h2><a href="#hui-gu-js-shu-ju-lei-xing" class="header-anchor">#</a><span id="hui-gu-js-shu-ju-lei-xing">回顾 js 数据类型</span></h2><ul><li>对象类型</li><li>原始数据类型：布尔值，数字，字符串，null，undefined，symbol</li></ul><h2><a href="#void" class="header-anchor">#</a><span id="void">void</span></h2><ul><li>没有返回值的函数</li><li>声明一个 <code>void</code> 类型的变量没有什么用，因为你只能将它赋值为 <code>undefined</code> 和 <code>null</code><ul><li><code>let unusable: void = undefined;</code></li></ul></li></ul><h2><a href="#undefined-he-null-shi-suo-you-lei-xing-de-zi-lei-xing" class="header-anchor">#</a><span id="undefined-he-null-shi-suo-you-lei-xing-de-zi-lei-xing">undefined 和 null 是所有类型的子类型</span></h2><p>可以赋值给任意类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num: <span class="built_in">number</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">let</span> a: <span class="built_in">void</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">num = a; <span class="comment">// Type &#x27;void&#x27; is not assignable to type &#x27;number&#x27;</span></span><br></pre></td></tr></table></figure><h2><a href="#any" class="header-anchor">#</a><span id="any">any</span></h2><p>在任意值上可以访问任何属性</p><p>也允许调用任何方法（存疑，见代码）</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> anyThing: <span class="built_in">any</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(anyThing.myName); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> anyOne: <span class="built_in">any</span> = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(anyOne.sayHello()); <span class="comment">// TypeError: anyOne.sayHello is not a function</span></span><br></pre></td></tr></table></figure><h3><a href="#ying-yong-yu-vue-ts" class="header-anchor">#</a><span id="ying-yong-yu-vue-ts">应用于 Vue+ts</span></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$refs[<span class="string">&quot;adSpace&quot;</span>].validate(); <span class="comment">// Property &#x27;validate&#x27; does not exist on type &#x27;Vue | Element | (Vue | Element)[]&#x27;.</span></span><br><span class="line"></span><br><span class="line">(<span class="built_in">this</span>.$refs[<span class="string">&quot;adSpace&quot;</span>] <span class="keyword">as</span> <span class="built_in">any</span>).validate();</span><br></pre></td></tr></table></figure><h2><a href="#lian-he-lei-xing" class="header-anchor">#</a><span id="lian-he-lei-xing">联合类型</span></h2><p>eg: <code>let myFavoriteNumber: string | number</code></p><h3><a href="#zhi-neng-fang-wen-gong-you-de-shu-xing-huo-fang-fa" class="header-anchor">#</a><span id="zhi-neng-fang-wen-gong-you-de-shu-xing-huo-fang-fa">只能访问共有的属性或方法</span></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">something: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> something.length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test.ts:2:20 - error TS2339: Property &#x27;length&#x27; does not exist on type &#x27;string | number&#x27;.</span></span><br><span class="line"><span class="comment">//  Property &#x27;length&#x27; does not exist on type &#x27;number&#x27;.</span></span><br></pre></td></tr></table></figure><h1><a href="#jie-kou" class="header-anchor">#</a><span id="jie-kou">接口</span></h1><h2><a href="#ke-xuan-zhi-du-ren-yi-shu-xing" class="header-anchor">#</a><span id="ke-xuan-zhi-du-ren-yi-shu-xing">可选、只读、任意属性</span></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Person &#123;</span><br><span class="line">  <span class="comment">// 只读</span></span><br><span class="line">  <span class="keyword">readonly</span> id: <span class="built_in">number</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// 可选</span></span><br><span class="line">  age?: <span class="built_in">number</span>;</span><br><span class="line">  <span class="comment">// 任意属性</span></span><br><span class="line">  <span class="comment">// 注：一旦定义了任意属性，那么确定属性和可选属性的类型都必须是任意属性类型(比如下面的 any)的子类；</span></span><br><span class="line">  [propName: <span class="built_in">string</span>]: <span class="built_in">any</span>;</span><br><span class="line">  <span class="comment">// [propName: string]: number | string;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><a href="#ts-ru-he-pan-duan-shi-li-shi-fou-shi-xian-liao-jie-kou" class="header-anchor">#</a><span id="ts-ru-he-pan-duan-shi-li-shi-fou-shi-xian-liao-jie-kou">ts 如何判断实例是否实现了接口</span></h2><p>不能用 instanceof，因为运行时是不存在 Interface，只能基于接口形状进行判断</p><h1><a href="#shu-zu" class="header-anchor">#</a><span id="shu-zu">数组</span></h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a: [<span class="built_in">number</span>, <span class="built_in">string</span>, <span class="built_in">any</span>] = [<span class="number">3</span>, <span class="string">&quot;7&quot;</span>, <span class="literal">undefined</span>];</span><br><span class="line"><span class="keyword">let</span> b: <span class="built_in">number</span>[] = [<span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> c: <span class="built_in">any</span>[] = [<span class="number">4</span>, <span class="string">&quot;5&quot;</span>, <span class="literal">null</span>, <span class="literal">undefined</span>];</span><br></pre></td></tr></table></figure><h1><a href="#lei-xing-duan-yan" class="header-anchor">#</a><span id="lei-xing-duan-yan">类型断言</span></h1><p>手动指定一个值的类型, <code>&lt;type&gt;value</code> 或 <code>value as type</code><br>tsx 中只能用 <code>value as type</code>，建议统一用 <code>value as type</code></p><ul><li>将一个联合类型断言为其中一个类型</li><li>将一个父类断言为更加具体的子类</li><li>将一个子类断言为父类</li><li>将任何一个类型断言为 any</li><li>将 any 断言为一个具体的类型</li></ul><h2><a href="#duan-yan-de-xian-zhi-tiao-jian" class="header-anchor">#</a><span id="duan-yan-de-xian-zhi-tiao-jian">断言的限制条件</span></h2><p>我们注意到，父子类可以互相断言，any 和其他类型可以互相断言</p><p>在 typescript 中，父类<code>兼容</code>子类，比如 <code>Cat extends Animal</code> 即 <code>Animal 兼容 Cat</code></p><p><strong><em>A 和 B 互相断言的前提：A 兼容 B 或者 B 兼容 A</em></strong></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将一个联合类型断言为其中一个类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">something: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((&lt;<span class="built_in">string</span>&gt;something).length) &#123;</span><br><span class="line">    <span class="keyword">return</span> (&lt;<span class="built_in">string</span>&gt;something).length;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> something.toString().length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><a href="#jiang-zi-lei-shi-li-ke-fu-gei-fu-lei-bian-liang" class="header-anchor">#</a><span id="jiang-zi-lei-shi-li-ke-fu-gei-fu-lei-bian-liang">将子类实例可赋给父类变量</span></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Animal &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Cat &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  run(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> tom: Cat = &#123;</span><br><span class="line">  name: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">  run: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> animal: Animal = tom;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;将子类实例赋给父类变量&quot;</span>, animal);</span><br></pre></td></tr></table></figure><h2><a href="#fu-zhi-shi-jin-liang-bi-mian-yong-lei-xing-duan-yan" class="header-anchor">#</a><span id="fu-zhi-shi-jin-liang-bi-mian-yong-lei-xing-duan-yan">赋值时尽量避免用类型断言</span></h2><p>我们通过断言 <code>animal as Cat</code> 成功赋值给变量 cat，使 cat 在后续中被当为 Cat 类型，但很明显此时的 cat 是不完整的</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Animal, Cat &#125; <span class="keyword">from</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> animal: Animal = &#123; <span class="attr">name</span>: <span class="string">&quot;father-class-instance&quot;</span> &#125;;</span><br><span class="line"><span class="comment">// let cat: Cat = animal; // Property &#x27;run&#x27; is missing in type &#x27;Animal&#x27; but required in type &#x27;Cat&#x27;.</span></span><br><span class="line"><span class="keyword">let</span> cat = animal <span class="keyword">as</span> Cat; <span class="comment">// 不会报错</span></span><br><span class="line"><span class="built_in">console</span>.log(cat); <span class="comment">// &#123; name: &#x27;father-class-instance&#x27; &#125;</span></span><br></pre></td></tr></table></figure><h1><a href="#sheng-ming-wen-jian" class="header-anchor">#</a><span id="sheng-ming-wen-jian">声明文件</span></h1><p>引用第三方库时，比如 jQuery，由于 ts 无法识别 <code>$(&#39;#foo&#39;) 或 jQuery(&#39;#foo&#39;)</code>，此时需要对 $ 或 jQuery 这两个全局变量进行声明，书写声明文件（<code>.d.ts</code> 为后缀）</p><h2><a href="#guan-li-xia-zai-di-san-fang-ku-sheng-ming-wen-jian" class="header-anchor">#</a><span id="guan-li-xia-zai-di-san-fang-ku-sheng-ming-wen-jian">管理、下载第三方库声明文件</span></h2><ul><li>使用 <code>@types</code> 统一管理第三方库的声明文件</li><li>下载 <a href="#">@types</a> 管理下的 jQuery 声明文件 ：<code>npm install @types/jquery --save-dev</code><ul><li>其他第三方库声明文件 <a target="_blank" rel="noopener" href="https://www.npmjs.com/search?q=@types">https://www.npmjs.com/search?q=@types</a></li><li>当一个第三方库没有提供声明文件时，我们就需要自己书写声明文件了</li></ul></li></ul><h2><a href="#shu-xie-fa-bu-sheng-ming-wen-jian" class="header-anchor">#</a><span id="shu-xie-fa-bu-sheng-ming-wen-jian">书写、发布声明文件</span></h2><p><a target="_blank" rel="noopener" href="https://ts.xcatliu.com/basics/declaration-files">https://ts.xcatliu.com/basics/declaration-files</a></p><h1><a href="#nei-zhi-dui-xiang" class="header-anchor">#</a><span id="nei-zhi-dui-xiang">内置对象</span></h1><h3><a href="#ts-bao-han-js-dom-bom-de-nei-zhi-dui-xiang" class="header-anchor">#</a><span id="ts-bao-han-js-dom-bom-de-nei-zhi-dui-xiang">ts 包含 js、DOM、BOM 的内置对象</span></h3><p>很多 js、DOM、BOM 的内置对象，ts 已经在其核心库中定义了，我们可以直接在 ts 中使用这些类型如 <code>Document</code>、<code>HTMLElement</code>、<code>Event</code>、<code>NodeList</code>、<code>Boolean</code>、<code>Error</code>、<code>Date</code>、<code>RegExp</code> 等</p><h3><a href="#ts-bu-bao-han-node-js-de-nei-zhi-dui-xiang" class="header-anchor">#</a><span id="ts-bu-bao-han-node-js-de-nei-zhi-dui-xiang">ts 不包含 Node.js 的内置对象</span></h3><p>如果想用 TypeScript 写 Node.js，则需要引入第三方声明文件：<br><code>npm install @types/node --save-dev</code></p><h3><a href="#typescript-he-xin-ku-de-ding-yi-wen-jian" class="header-anchor">#</a><span id="typescript-he-xin-ku-de-ding-yi-wen-jian">TypeScript 核心库的定义文件</span></h3><p><a target="_blank" rel="noopener" href="https://github.com/Microsoft/TypeScript/tree/master/src/lib">https://github.com/Microsoft/TypeScript/tree/master/src/lib</a></p><h1><a href="#lei-xing-bie-ming" class="header-anchor">#</a><span id="lei-xing-bie-ming">类型别名</span></h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Name = <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> NameResolver = <span class="function">() =&gt;</span> <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">type</span> NameOrResolver = Name | NameResolver;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">n: NameOrResolver</span>): <span class="title">Name</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> n === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><a href="#zi-fu-chuan-zi-mian-liang-lei-xing" class="header-anchor">#</a><span id="zi-fu-chuan-zi-mian-liang-lei-xing">字符串字面量类型</span></h1><p>用来约束变量的取值只能是几个字符串之一，也用 <code>type</code> 来定义</p><p><code>type EventNames = &#39;click&#39; | &#39;scroll&#39; | &#39;mousemove&#39;</code></p><h1><a href="#yuan-zu" class="header-anchor">#</a><span id="yuan-zu">元组</span></h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tom: [<span class="built_in">string</span>, <span class="built_in">number</span>];</span><br><span class="line">tom = [<span class="string">&quot;Tom&quot;</span>, <span class="number">25</span>];</span><br><span class="line">tom.push(<span class="string">&quot;male&quot;</span>);</span><br><span class="line">tom.push(<span class="literal">true</span>); <span class="comment">// push tom 中未定义的元素，会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Argument of type &#x27;true&#x27; is not assignable to parameter of type &#x27;string | number&#x27;.</span></span><br></pre></td></tr></table></figure><h1><a href="#mei-ju" class="header-anchor">#</a><span id="mei-ju">枚举</span></h1><p>枚举（Enum）类型用于取值被限定在一定范围内的场景，比如一周只能有七天，颜色限定为红绿蓝等</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Days &#123;</span><br><span class="line">  Sun,</span><br><span class="line">  Mon,</span><br><span class="line">  Tue,</span><br><span class="line">  Wed,</span><br><span class="line">  Thu,</span><br><span class="line">  Fri,</span><br><span class="line">  Sat,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">&quot;Sun&quot;</span>] === <span class="number">0</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="number">0</span>] === <span class="string">&quot;Sun&quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h2><a href="#shou-dong-fu-zhi-bu-tui-jian" class="header-anchor">#</a><span id="shou-dong-fu-zhi-bu-tui-jian">手动赋值（不推荐）</span></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未手动赋值的，序号递增，步长为1</span></span><br><span class="line"><span class="built_in">enum</span> Days &#123;</span><br><span class="line">  Sun = <span class="number">7</span>,</span><br><span class="line">  Mon = <span class="number">1.5</span>,</span><br><span class="line">  Tue,</span><br><span class="line">  Wed,</span><br><span class="line">  Thu,</span><br><span class="line">  Fri,</span><br><span class="line">  Sat,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">&quot;Sun&quot;</span>] === <span class="number">7</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">&quot;Mon&quot;</span>] === <span class="number">1.5</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">&quot;Tue&quot;</span>] === <span class="number">2.5</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Days[<span class="string">&quot;Sat&quot;</span>] === <span class="number">6.5</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果紧接在计算所得项(Red)后面的是未手动赋值的项(Green, Blue)</span></span><br><span class="line"><span class="comment">// 那么它就会因为无法获得初始值而报错</span></span><br><span class="line"><span class="built_in">enum</span> Color &#123;</span><br><span class="line">  Red = <span class="string">&quot;red&quot;</span>.length,</span><br><span class="line">  Green,</span><br><span class="line">  Blue,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// index.ts(1,33): error TS1061: Enum member must have initializer.</span></span><br><span class="line"><span class="comment">// index.ts(1,40): error TS1061: Enum member must have initializer.</span></span><br></pre></td></tr></table></figure><h2><a href="#chang-shu-mei-ju-const-enum" class="header-anchor">#</a><span id="chang-shu-mei-ju-const-enum">常数枚举 const enum</span></h2><p>常数枚举是使用 <code>const enum</code> 定义的枚举类型</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 常数枚举不允许有计算成员</span></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">enum</span> Color &#123;</span><br><span class="line">  Red,</span><br><span class="line">  Green,</span><br><span class="line">  Blue = <span class="string">&quot;blue&quot;</span>.length,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// index.ts(1,38): error TS2474: In &#x27;const&#x27; enum declarations member initializer must be constant expression.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 常数枚举的类型如 Directions 会在编译阶段被删除</span></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">enum</span> Directions &#123;</span><br><span class="line">  Up,</span><br><span class="line">  Down,</span><br><span class="line">  Left,</span><br><span class="line">  Right,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> directions = [</span><br><span class="line">  Directions.Up,</span><br><span class="line">  Directions.Down,</span><br><span class="line">  Directions.Left,</span><br><span class="line">  Directions.Right,</span><br><span class="line">];</span><br><span class="line"><span class="comment">// 编译结果</span></span><br><span class="line"><span class="keyword">var</span> directions = [<span class="number">0</span> <span class="comment">/* Up */</span>, <span class="number">1</span> <span class="comment">/* Down */</span>, <span class="number">2</span> <span class="comment">/* Left */</span>, <span class="number">3</span> <span class="comment">/* Right */</span>];</span><br></pre></td></tr></table></figure><h2><a href="#wai-bu-mei-ju-declare-enum" class="header-anchor">#</a><span id="wai-bu-mei-ju-declare-enum">外部枚举 declare enum</span></h2><p>常用于声明文件，在编译结果中也会被删除（节省空间吧）</p><h1><a href="#lei" class="header-anchor">#</a><span id="lei">类</span></h1><h2><a href="#xiang-guan-gai-nian" class="header-anchor">#</a><span id="xiang-guan-gai-nian">相关概念</span></h2><ul><li>抽象类（Abstract Class）：抽象类是供其他类继承的基类，抽象类不允许被实例化。抽象类中的抽象方法必须在子类中被实现</li></ul><h2><a href="#yong-fa" class="header-anchor">#</a><span id="yong-fa">用法</span></h2><h3><a href="#es6" class="header-anchor">#</a><span id="es6">ES6</span></h3><h4><a href="#ji-cheng" class="header-anchor">#</a><span id="ji-cheng">继承</span></h4><p>super 关键字调用父类的构造函数和方法</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name); <span class="comment">// 调用父类的 constructor(name)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">sayHi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Meow, &quot;</span> + <span class="built_in">super</span>.sayHi(); <span class="comment">// 调用父类的 sayHi()</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> Cat(<span class="string">&quot;Tom&quot;</span>); <span class="comment">// Tom</span></span><br><span class="line"><span class="built_in">console</span>.log(c.sayHi()); <span class="comment">// Meow, My name is Tom</span></span><br></pre></td></tr></table></figure><h4><a href="#getter-setter" class="header-anchor">#</a><span id="getter-setter">getter setter</span></h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Jack&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">set</span> <span class="title">name</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;setter: &quot;</span> + value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;Kitty&quot;</span>); <span class="comment">// setter: Kitty</span></span><br><span class="line">a.name = <span class="string">&quot;Tom&quot;</span>; <span class="comment">// setter: Tom</span></span><br><span class="line"><span class="built_in">console</span>.log(a.name); <span class="comment">// Jack</span></span><br></pre></td></tr></table></figure><h4><a href="#jing-tai-fang-fa-static" class="header-anchor">#</a><span id="jing-tai-fang-fa-static">静态方法 static</span></h4><p>直接通过类名来调用</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">isAnimal</span>(<span class="params">a</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a <span class="keyword">instanceof</span> Animal;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> Animal(<span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">Animal.isAnimal(a); <span class="comment">// true</span></span><br><span class="line">a.isAnimal(a); <span class="comment">// TypeError: a.isAnimal is not a function</span></span><br></pre></td></tr></table></figure><h2><a href="#fang-wen-xiu-shi-fu" class="header-anchor">#</a><span id="fang-wen-xiu-shi-fu">访问修饰符</span></h2><h3><a href="#public-private-protected" class="header-anchor">#</a><span id="public-private-protected">public private protected</span></h3><ul><li><p>访问修饰符，决定了属性、方法能否被访问，分三种 <em>**公有、私有、子类中可访问 **</em></p><ul><li>public 到处都可访问。属性、方法默认为 public</li><li>private 私有，不能在 <em><strong>声明它的类</strong></em> 的外部访问</li><li>protected 可以在子类中访问</li></ul></li><li><p>修饰构造函数</p><ul><li>private constructor 不允许继承和实例化</li><li>protected constructor 只允许继承</li></ul></li><li><p>修饰构造函数参数</p></li></ul><p>相当于 <em><strong>定义且赋值参数</strong></em></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="comment">// public name: string;</span></span><br><span class="line">  <span class="comment">// 不限制类型，这里的 string 只是举例，下面实例化给了数字 3</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> name</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// this.name = name;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a.name);</span><br></pre></td></tr></table></figure><h3><a href="#readonly" class="header-anchor">#</a><span id="readonly">readonly</span></h3><p>readonly 也是访问修饰符，跟 public 三者在一起时要放后面，如 <code>public ``readonly</code></p><h2><a href="#chou-xiang-lei" class="header-anchor">#</a><span id="chou-xiang-lei">抽象类</span></h2><ul><li>abstract class 用于继承，且子类必须实现 abstract class 中的 abstract function</li></ul><h1><a href="#lei-yu-jie-kou" class="header-anchor">#</a><span id="lei-yu-jie-kou">类与接口</span></h1><h2><a href="#lei-shi-xian-jie-kou" class="header-anchor">#</a><span id="lei-shi-xian-jie-kou">类实现接口</span></h2><p>类的一些共同特性可抽出来作为接口，让所有类来 implement (实现)，一个类可实现多个接口</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Alarm &#123;</span><br><span class="line">  alert(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Light &#123;</span><br><span class="line">  lightOn(): <span class="built_in">void</span>;</span><br><span class="line">  lightOff(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Door</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecurityDoor</span> <span class="keyword">extends</span> <span class="title">Door</span> <span class="title">implements</span> <span class="title">Alarm</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">alert</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;SecurityDoor alert&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="title">implements</span> <span class="title">Alarm</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">alert</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Car alert&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">lightOn</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Car light on&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">lightOff</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;Car light off&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><a href="#jie-kou-ji-cheng-jie-kou" class="header-anchor">#</a><span id="jie-kou-ji-cheng-jie-kou">接口继承接口</span></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Alarm &#123;</span><br><span class="line">  alert(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> LightableAlarm <span class="keyword">extends</span> Alarm &#123;</span><br><span class="line">  lightOn(): <span class="built_in">void</span>;</span><br><span class="line">  lightOff(): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><a href="#jie-kou-ji-cheng-lei" class="header-anchor">#</a><span id="jie-kou-ji-cheng-lei">接口继承类</span></h2><p>不常用，此处不赘述</p><h1><a href="#fan-xing" class="header-anchor">#</a><span id="fan-xing">泛型</span></h1><p>定义函数、接口、类的时候，不预先指定类型，使用时再指定类型的一种特性</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createArray</span>&lt;<span class="title">T</span>&gt;(<span class="params">length: <span class="built_in">number</span>, value: T</span>): <span class="title">Array</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result: T[] = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    result[i] = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定 T 为 string</span></span><br><span class="line">createArray&lt;<span class="built_in">string</span>&gt;(<span class="number">3</span>, <span class="string">&quot;x&quot;</span>); <span class="comment">// [&#x27;x&#x27;, &#x27;x&#x27;, &#x27;x&#x27;]</span></span><br><span class="line"><span class="comment">// 不指定 T，由 ts 自己推出来</span></span><br><span class="line">createArray(<span class="number">3</span>, <span class="string">&quot;x&quot;</span>); <span class="comment">// [&#x27;x&#x27;, &#x27;x&#x27;, &#x27;x&#x27;]</span></span><br></pre></td></tr></table></figure><h2><a href="#duo-ge-lei-xing-can-shu" class="header-anchor">#</a><span id="duo-ge-lei-xing-can-shu">多个类型参数</span></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swap</span>&lt;<span class="title">T</span>, <span class="title">U</span>&gt;(<span class="params">tuple: [T, U]</span>): [<span class="title">U</span>, <span class="title">T</span>] </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [tuple[<span class="number">1</span>], tuple[<span class="number">0</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">swap([<span class="number">7</span>, <span class="string">&quot;seven&quot;</span>]); <span class="comment">// [&#x27;seven&#x27;, 7]</span></span><br></pre></td></tr></table></figure><h1><a href="#sheng-ming-he-bing" class="header-anchor">#</a><span id="sheng-ming-he-bing">声明合并</span></h1><h1><a href="#kuo-zhan-yue-du" class="header-anchor">#</a><span id="kuo-zhan-yue-du">扩展阅读</span></h1></div><footer class="article-footer"><a data-url="http://example.com/2021/09/10/ts/" data-id="cku5jkivp000p7h0c5jhzfb08" class="article-share-link">Share</a> <a href="http://example.com/2021/09/10/ts/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Typescript/" rel="tag">Typescript</a></li></ul></footer></div></article><article id="post-GraphQL" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/09/GraphQL/" class="article-date"><time datetime="2021-09-09T02:34:53.000Z" itemprop="datePublished">2021-09-09</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/09/GraphQL/">GraphQL</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#ge-duan-zhi-ze-yu-xie-zuo">各端职责与协作</a></li><li><a href="#dui-bi-yi-wang-ji-yu-restful-feng-ge-jie-kou-de-xie-zuo">对比以往基于 RESTful 风格接口的协作</a></li><li><a href="#xie-fa">写法</a><ul><li><a href="#schema">schema</a></li><li><a href="#cha-xun-he-response">查询和 response</a></li></ul></li></ul></div><h1><a href="#ge-duan-zhi-ze-yu-xie-zuo" class="header-anchor">#</a><span id="ge-duan-zhi-ze-yu-xie-zuo">各端职责与协作</span></h1><ul><li>前后端讨论定义 schema<ul><li>schema 里是<strong><em>含类型的业务字段 + 业务字段进一步的聚合</em></strong></li></ul></li><li>后端需要提供 <em><strong>schema 形状的接口</strong></em></li><li>前端撰写 <em><strong>schema 查询和解析函数</strong></em></li></ul><h1><a href="#dui-bi-yi-wang-ji-yu-restful-feng-ge-jie-kou-de-xie-zuo" class="header-anchor">#</a><span id="dui-bi-yi-wang-ji-yu-restful-feng-ge-jie-kou-de-xie-zuo">对比以往基于 RESTful 风格接口的协作</span></h1><p>对于前端，只不过是提前把 <code>业务model</code> 写出来，以前是在得到响应后开始整理 <code>业务model</code>，比如 <code>this.list = res.data.list</code></p><p>对于后端，则改动很大</p><ul><li>写法大变动，要搭建 GraphQL 服务</li><li>以前是一个需求 <code>新增一个接口</code>，现在则 <code>新增一个 schema</code>，可能更多的是在原有的 <code>schema</code> 上进行改动（相比新增接口多了点风险，且对业务能力要求更高，但有助于提炼业务）</li></ul><h1><a href="#xie-fa" class="header-anchor">#</a><span id="xie-fa">写法</span></h1><h2><a href="#schema" class="header-anchor">#</a><span id="schema">schema</span></h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型字段，假设位于 a 文件</span></span><br><span class="line"><span class="keyword">type</span> Query &#123;</span><br><span class="line">  me: User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User &#123;</span><br><span class="line">  id: ID</span><br><span class="line">  name: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应的解析函数，假设位于 b 文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Query_me</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request.auth.user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">User_name</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> user.getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><a href="#cha-xun-he-response" class="header-anchor">#</a><span id="cha-xun-he-response">查询和 response</span></h2><p>SQL 之类的查询和 response</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line">&#123;</span><br><span class="line">  me &#123;</span><br><span class="line">    name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// response</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;me&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Luke Skywalker&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://example.com/2021/09/09/GraphQL/" data-id="cku5jkiun00017h0c00bmc9gg" class="article-share-link">Share</a> <a href="http://example.com/2021/09/09/GraphQL/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8E%A5%E5%8F%A3%E9%A3%8E%E6%A0%BC/" rel="tag">接口风格</a></li></ul></footer></div></article><article id="post-vue公共组件" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/08/vue%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6/" class="article-date"><time datetime="2021-09-08T12:04:59.000Z" itemprop="datePublished">2021-09-08</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/08/vue%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6/">vue公共组件</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#can-kao-xie-fa">参考写法</a><ul><li><a href="#chong-dian">重点</a></li><li><a href="#wen-jian-jie-gou">文件结构</a><ul><li><a href="#index-ts">index.ts</a></li><li><a href="#message-vue">Message.vue</a></li></ul></li></ul></li></ul></div><h1><a href="#can-kao-xie-fa" class="header-anchor">#</a><span id="can-kao-xie-fa">参考写法</span></h1><h2><a href="#chong-dian" class="header-anchor">#</a><span id="chong-dian">重点</span></h2><p>在单例上进行扩展和处理</p><h2><a href="#wen-jian-jie-gou" class="header-anchor">#</a><span id="wen-jian-jie-gou">文件结构</span></h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">message</span><br><span class="line">- index.ts</span><br><span class="line">- Message.vue</span><br></pre></td></tr></table></figure><h3><a href="#index-ts" class="header-anchor">#</a><span id="index-ts">index.ts</span></h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Message <span class="keyword">from</span> <span class="string">&quot;./Message.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> MessageType = <span class="string">&quot;default&quot;</span> | <span class="string">&quot;success&quot;</span> | <span class="string">&quot;error&quot;</span> | <span class="string">&quot;warning&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MessageOptions &#123;</span><br><span class="line">  <span class="keyword">type</span>?: MessageType;</span><br><span class="line">  time?: <span class="built_in">number</span>;</span><br><span class="line">  callback?: <span class="function">() =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  单例模式</span></span><br><span class="line"><span class="keyword">let</span> vm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="function">(<span class="params">Vue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> Component = Vue.extend(Message);</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$message = (</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">    options?: MessageType | MessageOptions</span><br><span class="line">  ) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> data = &#123;</span><br><span class="line">      content,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vm) &#123;</span><br><span class="line">      vm.$destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">      data[<span class="string">&quot;type&quot;</span>] = options;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">Object</span>.assign(data, options);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> instance = <span class="keyword">new</span> Component(&#123;</span><br><span class="line">      data,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    vm = instance.$mount();</span><br><span class="line">    vm.show = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    vm.$on(<span class="string">&quot;destroyed&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm = <span class="literal">null</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> vm;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install,</span><br><span class="line">  Message,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3><a href="#message-vue" class="header-anchor">#</a><span id="message-vue">Message.vue</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;transition name&#x3D;&quot;slide&quot; @after-leave&#x3D;&quot;afterLeave&quot;&gt;</span><br><span class="line">    &lt;div v-if&#x3D;&quot;show&quot; :class&#x3D;&quot;component_class&quot; @click&#x3D;&quot;show &#x3D; false&quot;&gt;</span><br><span class="line">      &#123;&#123; content &#125;&#125;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;transition&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;less&quot; scoped&gt;</span><br><span class="line">.message &#123;</span><br><span class="line">  position: fixed;</span><br><span class="line">  bottom: 60px;</span><br><span class="line">  left: 50%;</span><br><span class="line">  font-size: 14px;</span><br><span class="line">  color: #333;</span><br><span class="line">  padding: 5px 10px;</span><br><span class="line">  text-align: center;</span><br><span class="line">  overflow: hidden;</span><br><span class="line">  opacity: 0.9;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  min-width: 60px;</span><br><span class="line">  max-width: 60%;</span><br><span class="line">  word-break: break-all;</span><br><span class="line">  box-shadow: 1px 1px 2px 1px rgba(0, 0, 0, 0.16);</span><br><span class="line">  transform: translate(-50%, 0);</span><br><span class="line">  z-index: 10001;</span><br><span class="line"></span><br><span class="line">  &amp;.default &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: #333;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;.success &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: @success;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;.warning &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: @warning;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &amp;.error &#123;</span><br><span class="line">    color: #fff;</span><br><span class="line">    background-color: @error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.slide-enter-active,</span><br><span class="line">.slide-leave-active &#123;</span><br><span class="line">  transition: all 0.3s;</span><br><span class="line">&#125;</span><br><span class="line">.slide-enter,</span><br><span class="line">.slide-leave-to &#123;</span><br><span class="line">  transform: translate(-50%, 10px);</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">import &#123; Vue, Component &#125; from &quot;vue-property-decorator&quot;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;&#125;)</span><br><span class="line">export default class Toast extends Vue &#123;</span><br><span class="line">  show &#x3D; false;</span><br><span class="line">  content &#x3D; &quot;&quot;;</span><br><span class="line">  time &#x3D; 2000;</span><br><span class="line">  type &#x3D; &quot;default&quot;;</span><br><span class="line">  callback &#x3D; null;</span><br><span class="line"></span><br><span class="line">  get component_class() &#123;</span><br><span class="line">    return [&quot;message&quot;, &#96;$&#123;this.type&#125;&#96;];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mounted() &#123;</span><br><span class="line">    document.body.appendChild(this.$el);</span><br><span class="line">    this.time &amp;&amp; setTimeout(this.close, this.time);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    document.body.removeChild(this.$el);</span><br><span class="line">    this.callback &amp;&amp;</span><br><span class="line">      this.$nextTick(() &#x3D;&gt; &#123;</span><br><span class="line">        this.callback();</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    this.$emit(&quot;destroyed&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  close() &#123;</span><br><span class="line">    this.show &#x3D; false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  afterLeave() &#123;</span><br><span class="line">    this.$destroy();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://example.com/2021/09/08/vue%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6/" data-id="cku5jkivr000r7h0c9fvvfenf" class="article-share-link">Share</a> <a href="http://example.com/2021/09/08/vue%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul></footer></div></article><article id="post-其他" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2021/09/06/%E5%85%B6%E4%BB%96/" class="article-date"><time datetime="2021-09-06T09:50:35.000Z" itemprop="datePublished">2021-09-06</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2021/09/06/%E5%85%B6%E4%BB%96/">其他</a></h1></header><div class="article-entry" itemprop="articleBody"><div class="toc"><ul><li><a href="#sheng-cheng-mu-lu-shu">生成目录树</a></li><li><a href="#vim">vim</a></li></ul></div><h1><a href="#sheng-cheng-mu-lu-shu" class="header-anchor">#</a><span id="sheng-cheng-mu-lu-shu">生成目录树</span></h1><p>win 下<br><code>$ tree /f &gt; tree.md</code></p><p>mac 下 bash<br><code>tree &gt; tree.md</code></p><h1><a href="#vim" class="header-anchor">#</a><span id="vim">vim</span></h1><p>i 进入编辑模式<br>esc 后输入 :wq 保存退出</p></div><footer class="article-footer"><a data-url="http://example.com/2021/09/06/%E5%85%B6%E4%BB%96/" data-id="cku5jkiw100157h0cd5lq3is3" class="article-share-link">Share</a> <a href="http://example.com/2021/09/06/%E5%85%B6%E4%BB%96/#ds-thread" class="article-comment-link">Comments</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul></footer></div></article><nav id="page-nav"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next</a></nav></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2021 lanying<br>Powered by <a href="//hexo.io/" target="_blank">Hexo</a> . Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/archives" class="mobile-nav-link">Archives</a></nav><div id="totop"><a title="totop"><img src="/img/scrollup.png"></a></div><script type="text/javascript">var duoshuoQuery={short_name:"reqianduan"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><script src="/js/script.js"></script></div></body></html>